<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>useContext - React ä¸­æ–‡æ–‡æ¡£</title>
  <meta name="description" content="ä»å…¥é—¨åˆ°ç²¾é€šï¼Œå…¨é¢æŒæ¡Reactå¼€å‘æŠ€èƒ½">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/highlight.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">âš›ï¸</span>
          <div class="logo-text">
            <h1>React ä¸­æ–‡æ–‡æ¡£</h1>
            <p>ç°ä»£åŒ–çš„Reactå­¦ä¹ æŒ‡å—</p>
          </div>
        </div>
        <nav class="header-nav">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
          <a href="#" class="nav-link" onclick="toggleSidebar()">ç›®å½•</a>
          <a href="https://github.com/facebook/react" target="_blank" class="nav-link">GitHub</a>
        </nav>
      </div>
    </header>

    <div class="main-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <div class="search-box">
            <input type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput" onkeyup="searchDocs()">
            <span class="search-icon">ğŸ”</span>
          </div>
          <nav class="doc-nav">
            
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“š</span>
          åŸºç¡€æ¦‚å¿µ
        </h3>
        <ul class="category-docs">
          <li><a href="01-Reactç®€ä»‹.html" class="doc-link">Reactç®€ä»‹</a></li><li><a href="02-ç¯å¢ƒæ­å»º.html" class="doc-link">ç¯å¢ƒæ­å»º</a></li><li><a href="03-JSXè¯­æ³•.html" class="doc-link">JSXè¯­æ³•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§©</span>
          ç»„ä»¶å¼€å‘
        </h3>
        <ul class="category-docs">
          <li><a href="04-ç»„ä»¶åŸºç¡€.html" class="doc-link">ç»„ä»¶åŸºç¡€</a></li><li><a href="05-Propsä¸State.html" class="doc-link">Propsä¸State</a></li><li><a href="06-äº‹ä»¶å¤„ç†.html" class="doc-link">äº‹ä»¶å¤„ç†</a></li><li><a href="07-æ¡ä»¶æ¸²æŸ“.html" class="doc-link">æ¡ä»¶æ¸²æŸ“</a></li><li><a href="08-åˆ—è¡¨æ¸²æŸ“.html" class="doc-link">åˆ—è¡¨æ¸²æŸ“</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ£</span>
          Hooks API
        </h3>
        <ul class="category-docs">
          <li><a href="09-Hooksæ¦‚è¿°.html" class="doc-link">Hooksæ¦‚è¿°</a></li><li><a href="10-useState.html" class="doc-link">useState</a></li><li><a href="11-useEffect.html" class="doc-link">useEffect</a></li><li><a href="12-useContext.html" class="doc-link">useContext</a></li><li><a href="13-useReducer.html" class="doc-link">useReducer</a></li><li><a href="14-useMemoå’ŒuseCallback.html" class="doc-link">useMemoå’ŒuseCallback</a></li><li><a href="15-useRef.html" class="doc-link">useRef</a></li><li><a href="16-è‡ªå®šä¹‰Hooks.html" class="doc-link">è‡ªå®šä¹‰Hooks</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ”„</span>
          ç”Ÿå‘½å‘¨æœŸ
        </h3>
        <ul class="category-docs">
          <li><a href="17-ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.html" class="doc-link">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li><li><a href="18-å‰¯ä½œç”¨å¤„ç†.html" class="doc-link">å‰¯ä½œç”¨å¤„ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ¨</span>
          æ ·å¼ä¸UI
        </h3>
        <ul class="category-docs">
          <li><a href="19-æ ·å¼å¤„ç†.html" class="doc-link">æ ·å¼å¤„ç†</a></li><li><a href="20-åŠ¨ç”»æ•ˆæœ.html" class="doc-link">åŠ¨ç”»æ•ˆæœ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ºï¸</span>
          è·¯ç”±ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="21-React-Router.html" class="doc-link">React-Router</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“¦</span>
          çŠ¶æ€ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="22-Context-API.html" class="doc-link">Context-API</a></li><li><a href="23-Reduxé›†æˆ.html" class="doc-link">Reduxé›†æˆ</a></li><li><a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="doc-link">ZustandçŠ¶æ€ç®¡ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸš€</span>
          æ€§èƒ½ä¼˜åŒ–
        </h3>
        <ul class="category-docs">
          <li><a href="25-æ€§èƒ½ä¼˜åŒ–æŠ€å·§.html" class="doc-link">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href="26-ä»£ç åˆ†å‰².html" class="doc-link">ä»£ç åˆ†å‰²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§ª</span>
          æµ‹è¯•
        </h3>
        <ul class="category-docs">
          <li><a href="27-å•å…ƒæµ‹è¯•.html" class="doc-link">å•å…ƒæµ‹è¯•</a></li><li><a href="28-é›†æˆæµ‹è¯•.html" class="doc-link">é›†æˆæµ‹è¯•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ï¸</span>
          æ„å»ºä¸éƒ¨ç½²
        </h3>
        <ul class="category-docs">
          <li><a href="29-é¡¹ç›®æ„å»º.html" class="doc-link">é¡¹ç›®æ„å»º</a></li><li><a href="30-ç”Ÿäº§éƒ¨ç½².html" class="doc-link">ç”Ÿäº§éƒ¨ç½²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ› ï¸</span>
          å¼€å‘å·¥å…·
        </h3>
        <ul class="category-docs">
          <li><a href="31-å¼€å‘è€…å·¥å…·.html" class="doc-link">å¼€å‘è€…å·¥å…·</a></li><li><a href="32-è°ƒè¯•æŠ€å·§.html" class="doc-link">è°ƒè¯•æŠ€å·§</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“–</span>
          APIå‚è€ƒ
        </h3>
        <ul class="category-docs">
          <li><a href="33-React-APIå®Œæ•´å‚è€ƒ.html" class="doc-link">React-APIå®Œæ•´å‚è€ƒ</a></li><li><a href="34-DOMå…ƒç´ å±æ€§.html" class="doc-link">DOMå…ƒç´ å±æ€§</a></li><li><a href="35-åˆæˆäº‹ä»¶.html" class="doc-link">åˆæˆäº‹ä»¶</a></li><li><a href="React-Hookså®Œæ•´å‚è€ƒ.html" class="doc-link">React-Hookså®Œæ•´å‚è€ƒ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ’¡</span>
          æœ€ä½³å®è·µ
        </h3>
        <ul class="category-docs">
          <li><a href="36-ç¼–ç è§„èŒƒ.html" class="doc-link">ç¼–ç è§„èŒƒ</a></li><li><a href="37-é¡¹ç›®æ¶æ„.html" class="doc-link">é¡¹ç›®æ¶æ„</a></li><li><a href="38-å¸¸è§é—®é¢˜.html" class="doc-link">å¸¸è§é—®é¢˜</a></li>
        </ul>
      </div>
          </nav>
        </div>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="content">
        <article class="doc-article">
          <div class="doc-header">
            <div class="breadcrumb">
              <a href="index.html">é¦–é¡µ</a>
              <span class="separator">></span>
              <span class="current">useContext</span>
            </div>
            <h1 class="doc-title">useContext</h1>
            <div class="doc-meta">
              <span class="category" style="background: #4facfe">
                ğŸ£ Hooks API
              </span>
            </div>
          </div>
          
          <div class="doc-content">
            <h1>12-useContext</h1>
<p><code>useContext</code> æ˜¯React Hooksä¸­ç”¨äºæ¶ˆè´¹Contextçš„é’©å­ã€‚å®ƒæä¾›äº†ä¸€ç§åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«çŠ¶æ€çš„æ–¹å¼ï¼Œé¿å…äº†é€šè¿‡propsé€å±‚ä¼ é€’æ•°æ®çš„é—®é¢˜ï¼ˆprop drillingï¼‰ã€‚</p>
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>ä»€ä¹ˆæ˜¯Context</h3>
<p>Context æä¾›äº†ä¸€ä¸ªæ— éœ€ä¸ºæ¯å±‚ç»„ä»¶æ‰‹åŠ¨æ·»åŠ  propsï¼Œå°±èƒ½åœ¨ç»„ä»¶æ ‘é—´è¿›è¡Œæ•°æ®ä¼ é€’çš„æ–¹æ³•ã€‚</p>
<pre><code class="language-jsx">import React, { createContext, useContext } from &#39;react&#39;;

// åˆ›å»ºContext
const ThemeContext = createContext();

// æä¾›è€…ç»„ä»¶
function App() {
  const theme = {
    primary: &#39;#007bff&#39;,
    secondary: &#39;#6c757d&#39;,
    background: &#39;#ffffff&#39;
  };

  return (
    &lt;ThemeContext.Provider value={theme}&gt;
      &lt;Header /&gt;
      &lt;MainContent /&gt;
    &lt;/ThemeContext.Provider&gt;
  );
}

// æ¶ˆè´¹è€…ç»„ä»¶
function Header() {
  const theme = useContext(ThemeContext);
  
  return (
    &lt;header style={{ backgroundColor: theme.primary }}&gt;
      &lt;h1&gt;æˆ‘çš„åº”ç”¨&lt;/h1&gt;
    &lt;/header&gt;
  );
}

function MainContent() {
  const theme = useContext(ThemeContext);
  
  return (
    &lt;main style={{ backgroundColor: theme.background }}&gt;
      &lt;p&gt;ä¸»è¦å†…å®¹&lt;/p&gt;
    &lt;/main&gt;
  );
}
</code></pre>
<h2>åˆ›å»ºå’Œä½¿ç”¨Context</h2>
<h3>åŸºæœ¬æ­¥éª¤</h3>
<ol>
<li><strong>åˆ›å»ºContext</strong></li>
<li><strong>æä¾›Contextå€¼</strong></li>
<li><strong>æ¶ˆè´¹Contextå€¼</strong></li>
</ol>
<pre><code class="language-jsx">// 1. åˆ›å»ºContext
const UserContext = createContext();

// 2. åˆ›å»ºProviderç»„ä»¶
function UserProvider({ children }) {
  const [user, setUser] = useState({
    name: &#39;å¼ ä¸‰&#39;,
    email: &#39;zhangsan@example.com&#39;,
    role: &#39;admin&#39;
  });

  return (
    &lt;UserContext.Provider value={{ user, setUser }}&gt;
      {children}
    &lt;/UserContext.Provider&gt;
  );
}

// 3. åˆ›å»ºè‡ªå®šä¹‰Hookï¼ˆå¯é€‰ä½†æ¨èï¼‰
function useUser() {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error(&#39;useUser must be used within a UserProvider&#39;);
  }
  return context;
}

// 4. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function UserProfile() {
  const { user, setUser } = useUser();

  const handleNameChange = (newName) =&gt; {
    setUser(prev =&gt; ({ ...prev, name: newName }));
  };

  return (
    &lt;div&gt;
      &lt;h2&gt;ç”¨æˆ·ä¿¡æ¯&lt;/h2&gt;
      &lt;p&gt;å§“å: {user.name}&lt;/p&gt;
      &lt;p&gt;é‚®ç®±: {user.email}&lt;/p&gt;
      &lt;p&gt;è§’è‰²: {user.role}&lt;/p&gt;
      &lt;button onClick={() =&gt; handleNameChange(&#39;æå››&#39;)}&gt;
        æ›´æ”¹å§“å
      &lt;/button&gt;
    &lt;/div&gt;
  );
}

// 5. ä½¿ç”¨ProvideråŒ…è£…åº”ç”¨
function App() {
  return (
    &lt;UserProvider&gt;
      &lt;UserProfile /&gt;
    &lt;/UserProvider&gt;
  );
}
</code></pre>
<h2>é»˜è®¤å€¼</h2>
<h3>è®¾ç½®Contexté»˜è®¤å€¼</h3>
<pre><code class="language-jsx">const ThemeContext = createContext({
  mode: &#39;light&#39;,
  colors: {
    primary: &#39;#007bff&#39;,
    secondary: &#39;#6c757d&#39;
  },
  toggleMode: () =&gt; {}
});

// å³ä½¿æ²¡æœ‰Providerï¼Œç»„ä»¶ä¹Ÿèƒ½è·å–é»˜è®¤å€¼
function ThemeDisplay() {
  const { mode, colors } = useContext(ThemeContext);
  
  return (
    &lt;div style={{ color: colors.primary }}&gt;
      å½“å‰ä¸»é¢˜: {mode}
    &lt;/div&gt;
  );
}
</code></pre>
<h3>å¸¦ç±»å‹çš„Contextï¼ˆTypeScriptï¼‰</h3>
<pre><code class="language-tsx">interface User {
  id: string;
  name: string;
  email: string;
}

interface UserContextType {
  user: User | null;
  setUser: (user: User | null) =&gt; void;
  login: (email: string, password: string) =&gt; Promise&lt;void&gt;;
  logout: () =&gt; void;
}

const UserContext = createContext&lt;UserContextType | undefined&gt;(undefined);

function useUser(): UserContextType {
  const context = useContext(UserContext);
  if (context === undefined) {
    throw new Error(&#39;useUser must be used within a UserProvider&#39;);
  }
  return context;
}

function UserProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState&lt;User | null&gt;(null);

  const login = async (email: string, password: string) =&gt; {
    // ç™»å½•é€»è¾‘
    const userData = await authAPI.login(email, password);
    setUser(userData);
  };

  const logout = () =&gt; {
    setUser(null);
  };

  const value: UserContextType = {
    user,
    setUser,
    login,
    logout
  };

  return (
    &lt;UserContext.Provider value={value}&gt;
      {children}
    &lt;/UserContext.Provider&gt;
  );
}
</code></pre>
<h2>å¤šä¸ªContext</h2>
<h3>ç»„åˆå¤šä¸ªContext</h3>
<pre><code class="language-jsx">const ThemeContext = createContext();
const UserContext = createContext();
const LanguageContext = createContext();

function AppProviders({ children }) {
  return (
    &lt;ThemeProvider&gt;
      &lt;UserProvider&gt;
        &lt;LanguageProvider&gt;
          {children}
        &lt;/LanguageProvider&gt;
      &lt;/UserProvider&gt;
    &lt;/ThemeProvider&gt;
  );
}

// æˆ–è€…åˆ›å»ºç»„åˆProvider
function CombinedProvider({ children }) {
  const [theme, setTheme] = useState(&#39;light&#39;);
  const [user, setUser] = useState(null);
  const [language, setLanguage] = useState(&#39;zh&#39;);

  return (
    &lt;ThemeContext.Provider value={{ theme, setTheme }}&gt;
      &lt;UserContext.Provider value={{ user, setUser }}&gt;
        &lt;LanguageContext.Provider value={{ language, setLanguage }}&gt;
          {children}
        &lt;/LanguageContext.Provider&gt;
      &lt;/UserContext.Provider&gt;
    &lt;/ThemeContext.Provider&gt;
  );
}

// ä½¿ç”¨å¤šä¸ªContext
function MyComponent() {
  const { theme } = useContext(ThemeContext);
  const { user } = useContext(UserContext);
  const { language } = useContext(LanguageContext);

  return (
    &lt;div className={`theme-${theme} lang-${language}`}&gt;
      {user ? `Welcome, ${user.name}` : &#39;Please login&#39;}
    &lt;/div&gt;
  );
}
</code></pre>
<h2>å®é™…åº”ç”¨ç¤ºä¾‹</h2>
<h3>ä¸»é¢˜åˆ‡æ¢</h3>
<pre><code class="language-jsx">const ThemeContext = createContext();

const themes = {
  light: {
    mode: &#39;light&#39;,
    colors: {
      background: &#39;#ffffff&#39;,
      text: &#39;#000000&#39;,
      primary: &#39;#007bff&#39;
    }
  },
  dark: {
    mode: &#39;dark&#39;,
    colors: {
      background: &#39;#1a1a1a&#39;,
      text: &#39;#ffffff&#39;,
      primary: &#39;#66b3ff&#39;
    }
  }
};

function ThemeProvider({ children }) {
  const [currentTheme, setCurrentTheme] = useState(&#39;light&#39;);

  const toggleTheme = () =&gt; {
    setCurrentTheme(prev =&gt; prev === &#39;light&#39; ? &#39;dark&#39; : &#39;light&#39;);
  };

  const theme = themes[currentTheme];

  return (
    &lt;ThemeContext.Provider value={{ theme, toggleTheme }}&gt;
      &lt;div style={{
        backgroundColor: theme.colors.background,
        color: theme.colors.text,
        minHeight: &#39;100vh&#39;
      }}&gt;
        {children}
      &lt;/div&gt;
    &lt;/ThemeContext.Provider&gt;
  );
}

function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error(&#39;useTheme must be used within a ThemeProvider&#39;);
  }
  return context;
}

function ThemeToggleButton() {
  const { theme, toggleTheme } = useTheme();

  return (
    &lt;button
      onClick={toggleTheme}
      style={{
        backgroundColor: theme.colors.primary,
        color: theme.colors.background,
        border: &#39;none&#39;,
        padding: &#39;8px 16px&#39;,
        borderRadius: &#39;4px&#39;
      }}
    &gt;
      åˆ‡æ¢åˆ°{theme.mode === &#39;light&#39; ? &#39;æ·±è‰²&#39; : &#39;æµ…è‰²&#39;}ä¸»é¢˜
    &lt;/button&gt;
  );
}
</code></pre>
<h3>è´­ç‰©è½¦Context</h3>
<pre><code class="language-jsx">const CartContext = createContext();

function CartProvider({ children }) {
  const [items, setItems] = useState([]);

  const addItem = (product) =&gt; {
    setItems(prev =&gt; {
      const existingItem = prev.find(item =&gt; item.id === product.id);
      if (existingItem) {
        return prev.map(item =&gt;
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prev, { ...product, quantity: 1 }];
    });
  };

  const removeItem = (productId) =&gt; {
    setItems(prev =&gt; prev.filter(item =&gt; item.id !== productId));
  };

  const updateQuantity = (productId, quantity) =&gt; {
    if (quantity &lt;= 0) {
      removeItem(productId);
      return;
    }
    
    setItems(prev =&gt;
      prev.map(item =&gt;
        item.id === productId ? { ...item, quantity } : item
      )
    );
  };

  const clearCart = () =&gt; {
    setItems([]);
  };

  const getTotalPrice = () =&gt; {
    return items.reduce((total, item) =&gt; total + item.price * item.quantity, 0);
  };

  const getItemCount = () =&gt; {
    return items.reduce((count, item) =&gt; count + item.quantity, 0);
  };

  const value = {
    items,
    addItem,
    removeItem,
    updateQuantity,
    clearCart,
    getTotalPrice,
    getItemCount
  };

  return (
    &lt;CartContext.Provider value={value}&gt;
      {children}
    &lt;/CartContext.Provider&gt;
  );
}

function useCart() {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error(&#39;useCart must be used within a CartProvider&#39;);
  }
  return context;
}

// è´­ç‰©è½¦ç»„ä»¶
function CartSummary() {
  const { items, getTotalPrice, getItemCount } = useCart();

  return (
    &lt;div className=&quot;cart-summary&quot;&gt;
      &lt;h3&gt;è´­ç‰©è½¦&lt;/h3&gt;
      &lt;p&gt;å•†å“æ•°é‡: {getItemCount()}&lt;/p&gt;
      &lt;p&gt;æ€»ä»·: Â¥{getTotalPrice().toFixed(2)}&lt;/p&gt;
      {items.length === 0 &amp;&amp; &lt;p&gt;è´­ç‰©è½¦ä¸ºç©º&lt;/p&gt;}
    &lt;/div&gt;
  );
}

function ProductCard({ product }) {
  const { addItem } = useCart();

  return (
    &lt;div className=&quot;product-card&quot;&gt;
      &lt;h4&gt;{product.name}&lt;/h4&gt;
      &lt;p&gt;Â¥{product.price}&lt;/p&gt;
      &lt;button onClick={() =&gt; addItem(product)}&gt;
        åŠ å…¥è´­ç‰©è½¦
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h3>å…¨å±€çŠ¶æ€ç®¡ç†</h3>
<pre><code class="language-jsx">const AppStateContext = createContext();

function appStateReducer(state, action) {
  switch (action.type) {
    case &#39;SET_LOADING&#39;:
      return { ...state, loading: action.payload };
    case &#39;SET_ERROR&#39;:
      return { ...state, error: action.payload, loading: false };
    case &#39;SET_USER&#39;:
      return { ...state, user: action.payload, loading: false };
    case &#39;SET_NOTIFICATIONS&#39;:
      return { ...state, notifications: action.payload };
    case &#39;ADD_NOTIFICATION&#39;:
      return {
        ...state,
        notifications: [...state.notifications, action.payload]
      };
    case &#39;REMOVE_NOTIFICATION&#39;:
      return {
        ...state,
        notifications: state.notifications.filter(n =&gt; n.id !== action.payload)
      };
    default:
      return state;
  }
}

function AppStateProvider({ children }) {
  const [state, dispatch] = useReducer(appStateReducer, {
    user: null,
    loading: false,
    error: null,
    notifications: []
  });

  const setLoading = (loading) =&gt; {
    dispatch({ type: &#39;SET_LOADING&#39;, payload: loading });
  };

  const setError = (error) =&gt; {
    dispatch({ type: &#39;SET_ERROR&#39;, payload: error });
  };

  const setUser = (user) =&gt; {
    dispatch({ type: &#39;SET_USER&#39;, payload: user });
  };

  const addNotification = (notification) =&gt; {
    const id = Date.now();
    dispatch({
      type: &#39;ADD_NOTIFICATION&#39;,
      payload: { ...notification, id }
    });

    // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
    setTimeout(() =&gt; {
      removeNotification(id);
    }, 5000);
  };

  const removeNotification = (id) =&gt; {
    dispatch({ type: &#39;REMOVE_NOTIFICATION&#39;, payload: id });
  };

  const value = {
    ...state,
    setLoading,
    setError,
    setUser,
    addNotification,
    removeNotification
  };

  return (
    &lt;AppStateContext.Provider value={value}&gt;
      {children}
    &lt;/AppStateContext.Provider&gt;
  );
}

function useAppState() {
  const context = useContext(AppStateContext);
  if (!context) {
    throw new Error(&#39;useAppState must be used within AppStateProvider&#39;);
  }
  return context;
}
</code></pre>
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</h3>
<pre><code class="language-jsx">// âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
function BadProvider({ children }) {
  const [user, setUser] = useState(null);

  return (
    &lt;UserContext.Provider value={{ user, setUser }}&gt;
      {children}
    &lt;/UserContext.Provider&gt;
  );
}

// âœ… ä½¿ç”¨useMemoç¼“å­˜Contextå€¼
function GoodProvider({ children }) {
  const [user, setUser] = useState(null);

  const value = useMemo(() =&gt; ({
    user,
    setUser
  }), [user]);

  return (
    &lt;UserContext.Provider value={value}&gt;
      {children}
    &lt;/UserContext.Provider&gt;
  );
}
</code></pre>
<h3>åˆ†ç¦»é¢‘ç¹å˜åŒ–çš„çŠ¶æ€</h3>
<pre><code class="language-jsx">// åˆ†ç¦»å¿«é€Ÿå˜åŒ–çš„çŠ¶æ€å’Œç¨³å®šçš„çŠ¶æ€
const UserContext = createContext();
const UserActionsContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);

  // ç”¨æˆ·æ•°æ®ï¼ˆä¸å¸¸å˜åŒ–ï¼‰
  const userValue = useMemo(() =&gt; user, [user]);

  // ç”¨æˆ·æ“ä½œï¼ˆç¨³å®šçš„å‡½æ•°ï¼‰
  const actionsValue = useMemo(() =&gt; ({
    setUser,
    updateProfile: (profile) =&gt; {
      setUser(prev =&gt; ({ ...prev, ...profile }));
    },
    logout: () =&gt; setUser(null)
  }), []);

  return (
    &lt;UserContext.Provider value={userValue}&gt;
      &lt;UserActionsContext.Provider value={actionsValue}&gt;
        {children}
      &lt;/UserActionsContext.Provider&gt;
    &lt;/UserContext.Provider&gt;
  );
}

function useUser() {
  const user = useContext(UserContext);
  if (user === undefined) {
    throw new Error(&#39;useUser must be used within UserProvider&#39;);
  }
  return user;
}

function useUserActions() {
  const actions = useContext(UserActionsContext);
  if (!actions) {
    throw new Error(&#39;useUserActions must be used within UserProvider&#39;);
  }
  return actions;
}
</code></pre>
<h3>æ¡ä»¶æ¸²æŸ“Provider</h3>
<pre><code class="language-jsx">function ConditionalProvider({ children, condition }) {
  if (condition) {
    return (
      &lt;SomeContext.Provider value={someValue}&gt;
        {children}
      &lt;/SomeContext.Provider&gt;
    );
  }
  
  return children;
}
</code></pre>
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. åˆ›å»ºè‡ªå®šä¹‰Hook</h3>
<pre><code class="language-jsx">// ä¸ºæ¯ä¸ªContextåˆ›å»ºè‡ªå®šä¹‰Hook
function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error(&#39;useAuth must be used within an AuthProvider&#39;);
  }
  return context;
}
</code></pre>
<h3>2. æä¾›æœ‰æ„ä¹‰çš„é»˜è®¤å€¼</h3>
<pre><code class="language-jsx">const ThemeContext = createContext({
  mode: &#39;light&#39;,
  toggleMode: () =&gt; {
    console.warn(&#39;ThemeContext used outside of provider&#39;);
  }
});
</code></pre>
<h3>3. é”™è¯¯è¾¹ç•Œå¤„ç†</h3>
<pre><code class="language-jsx">function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);

  if (error) {
    throw error; // è®©Error Boundaryæ•è·
  }

  const login = async (credentials) =&gt; {
    try {
      const user = await authService.login(credentials);
      setUser(user);
    } catch (err) {
      setError(err);
    }
  };

  return (
    &lt;AuthContext.Provider value={{ user, login }}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
}
</code></pre>
<h3>4. ç»„åˆContext Providers</h3>
<pre><code class="language-jsx">function Providers({ children }) {
  return (
    &lt;ErrorBoundary&gt;
      &lt;AuthProvider&gt;
        &lt;ThemeProvider&gt;
          &lt;NotificationProvider&gt;
            {children}
          &lt;/NotificationProvider&gt;
        &lt;/ThemeProvider&gt;
      &lt;/AuthProvider&gt;
    &lt;/ErrorBoundary&gt;
  );
}
</code></pre>
<h2>å¸¸è§é—®é¢˜</h2>
<h3>é—®é¢˜1ï¼šContextå€¼ä¸ºundefined</h3>
<pre><code class="language-jsx">// âŒ æ²¡æœ‰æ£€æŸ¥Contextæ˜¯å¦å­˜åœ¨
function BadComponent() {
  const { user } = useContext(UserContext); // å¯èƒ½ä¸ºundefined
  return &lt;div&gt;{user.name}&lt;/div&gt;; // é”™è¯¯ï¼
}

// âœ… æ­£ç¡®çš„é”™è¯¯å¤„ç†
function GoodComponent() {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error(&#39;Component must be used within UserProvider&#39;);
  }
  const { user } = context;
  return &lt;div&gt;{user?.name || &#39;Guest&#39;}&lt;/div&gt;;
}
</code></pre>
<h3>é—®é¢˜2ï¼šè¿‡åº¦ä½¿ç”¨Context</h3>
<pre><code class="language-jsx">// âŒ ä¸ºæ¯ä¸ªå°çŠ¶æ€åˆ›å»ºContext
const CountContext = createContext();
const NameContext = createContext();
const EmailContext = createContext();

// âœ… åˆå¹¶ç›¸å…³çŠ¶æ€
const UserFormContext = createContext();

function UserFormProvider({ children }) {
  const [formData, setFormData] = useState({
    count: 0,
    name: &#39;&#39;,
    email: &#39;&#39;
  });

  return (
    &lt;UserFormContext.Provider value={{ formData, setFormData }}&gt;
      {children}
    &lt;/UserFormContext.Provider&gt;
  );
}
</code></pre>
<h3>é—®é¢˜3ï¼šContextå¯¼è‡´çš„æ€§èƒ½é—®é¢˜</h3>
<pre><code class="language-jsx">// âŒ é¢‘ç¹å˜åŒ–çš„å€¼å¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“
function BadProvider({ children }) {
  const [counter, setCounter] = useState(0);
  const [user, setUser] = useState(null);

  useEffect(() =&gt; {
    const timer = setInterval(() =&gt; setCounter(c =&gt; c + 1), 1000);
    return () =&gt; clearInterval(timer);
  }, []);

  return (
    &lt;MyContext.Provider value={{ counter, user, setUser }}&gt;
      {children}
    &lt;/MyContext.Provider&gt;
  );
}

// âœ… åˆ†ç¦»é¢‘ç¹å˜åŒ–çš„çŠ¶æ€
function GoodProvider({ children }) {
  const [user, setUser] = useState(null);

  const userActions = useMemo(() =&gt; ({
    setUser,
    updateUser: (updates) =&gt; setUser(prev =&gt; ({ ...prev, ...updates }))
  }), []);

  return (
    &lt;UserContext.Provider value={user}&gt;
      &lt;UserActionsContext.Provider value={userActions}&gt;
        &lt;CounterProvider&gt;
          {children}
        &lt;/CounterProvider&gt;
      &lt;/UserActionsContext.Provider&gt;
    &lt;/UserContext.Provider&gt;
  );
}
</code></pre>
<h2>æ€»ç»“</h2>
<p><code>useContext</code> æ˜¯Reactä¸­å¼ºå¤§çš„çŠ¶æ€å…±äº«å·¥å…·ï¼š</p>
<ol>
<li><strong>é¿å…prop drilling</strong>ï¼šç›´æ¥åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®</li>
<li><strong>åˆ›å»ºè‡ªå®šä¹‰Hook</strong>ï¼šæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½¿ç”¨useMemoé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šåˆç†ç»„ç»‡Contextï¼Œé¿å…è¿‡åº¦ä½¿ç”¨</li>
</ol>
<p>æ­£ç¡®ä½¿ç”¨Contextå¯ä»¥è®©ä½ çš„Reactåº”ç”¨çŠ¶æ€ç®¡ç†æ›´åŠ ç®€æ´å’Œé«˜æ•ˆã€‚ </p>

          </div>

          <!-- æ–‡æ¡£å¯¼èˆª -->
          <div class="doc-navigation">
            
              <a href="11-useEffect.html" class="nav-btn prev-btn">
                <span class="nav-icon">â†</span>
                <div class="nav-text">
                  <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                  <span class="nav-title">useEffect</span>
                </div>
              </a>
            
            
            
              <a href="13-useReducer.html" class="nav-btn next-btn">
                <div class="nav-text">
                  <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                  <span class="nav-title">useReducer</span>
                </div>
                <span class="nav-icon">â†’</span>
              </a>
            
          </div>
        </article>
      </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <span>â†‘</span>
    </button>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 React ä¸­æ–‡æ–‡æ¡£. åŸºäº React 18.x æ„å»º</p>
        <p>Made with â¤ï¸ by Reactä¸­æ–‡ç¤¾åŒº</p>
      </div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>