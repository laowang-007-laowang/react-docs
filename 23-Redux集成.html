<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reduxé›†æˆ - React ä¸­æ–‡æ–‡æ¡£</title>
  <meta name="description" content="ä»å…¥é—¨åˆ°ç²¾é€šï¼Œå…¨é¢æŒæ¡Reactå¼€å‘æŠ€èƒ½">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/highlight.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">âš›ï¸</span>
          <div class="logo-text">
            <h1>React ä¸­æ–‡æ–‡æ¡£</h1>
            <p>ç°ä»£åŒ–çš„Reactå­¦ä¹ æŒ‡å—</p>
          </div>
        </div>
        <nav class="header-nav">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
          <a href="#" class="nav-link" onclick="toggleSidebar()">ç›®å½•</a>
          <a href="https://github.com/facebook/react" target="_blank" class="nav-link">GitHub</a>
        </nav>
      </div>
    </header>

    <div class="main-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <div class="search-box">
            <input type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput" onkeyup="searchDocs()">
            <span class="search-icon">ğŸ”</span>
          </div>
          <nav class="doc-nav">
            
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“š</span>
          åŸºç¡€æ¦‚å¿µ
        </h3>
        <ul class="category-docs">
          <li><a href="01-Reactç®€ä»‹.html" class="doc-link">Reactç®€ä»‹</a></li><li><a href="02-ç¯å¢ƒæ­å»º.html" class="doc-link">ç¯å¢ƒæ­å»º</a></li><li><a href="03-JSXè¯­æ³•.html" class="doc-link">JSXè¯­æ³•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§©</span>
          ç»„ä»¶å¼€å‘
        </h3>
        <ul class="category-docs">
          <li><a href="04-ç»„ä»¶åŸºç¡€.html" class="doc-link">ç»„ä»¶åŸºç¡€</a></li><li><a href="05-Propsä¸State.html" class="doc-link">Propsä¸State</a></li><li><a href="06-äº‹ä»¶å¤„ç†.html" class="doc-link">äº‹ä»¶å¤„ç†</a></li><li><a href="07-æ¡ä»¶æ¸²æŸ“.html" class="doc-link">æ¡ä»¶æ¸²æŸ“</a></li><li><a href="08-åˆ—è¡¨æ¸²æŸ“.html" class="doc-link">åˆ—è¡¨æ¸²æŸ“</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ£</span>
          Hooks API
        </h3>
        <ul class="category-docs">
          <li><a href="09-Hooksæ¦‚è¿°.html" class="doc-link">Hooksæ¦‚è¿°</a></li><li><a href="10-useState.html" class="doc-link">useState</a></li><li><a href="11-useEffect.html" class="doc-link">useEffect</a></li><li><a href="12-useContext.html" class="doc-link">useContext</a></li><li><a href="13-useReducer.html" class="doc-link">useReducer</a></li><li><a href="14-useMemoå’ŒuseCallback.html" class="doc-link">useMemoå’ŒuseCallback</a></li><li><a href="15-useRef.html" class="doc-link">useRef</a></li><li><a href="16-è‡ªå®šä¹‰Hooks.html" class="doc-link">è‡ªå®šä¹‰Hooks</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ”„</span>
          ç”Ÿå‘½å‘¨æœŸ
        </h3>
        <ul class="category-docs">
          <li><a href="17-ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.html" class="doc-link">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li><li><a href="18-å‰¯ä½œç”¨å¤„ç†.html" class="doc-link">å‰¯ä½œç”¨å¤„ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ¨</span>
          æ ·å¼ä¸UI
        </h3>
        <ul class="category-docs">
          <li><a href="19-æ ·å¼å¤„ç†.html" class="doc-link">æ ·å¼å¤„ç†</a></li><li><a href="20-åŠ¨ç”»æ•ˆæœ.html" class="doc-link">åŠ¨ç”»æ•ˆæœ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ºï¸</span>
          è·¯ç”±ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="21-React-Router.html" class="doc-link">React-Router</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“¦</span>
          çŠ¶æ€ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="22-Context-API.html" class="doc-link">Context-API</a></li><li><a href="23-Reduxé›†æˆ.html" class="doc-link">Reduxé›†æˆ</a></li><li><a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="doc-link">ZustandçŠ¶æ€ç®¡ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸš€</span>
          æ€§èƒ½ä¼˜åŒ–
        </h3>
        <ul class="category-docs">
          <li><a href="25-æ€§èƒ½ä¼˜åŒ–æŠ€å·§.html" class="doc-link">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href="26-ä»£ç åˆ†å‰².html" class="doc-link">ä»£ç åˆ†å‰²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§ª</span>
          æµ‹è¯•
        </h3>
        <ul class="category-docs">
          <li><a href="27-å•å…ƒæµ‹è¯•.html" class="doc-link">å•å…ƒæµ‹è¯•</a></li><li><a href="28-é›†æˆæµ‹è¯•.html" class="doc-link">é›†æˆæµ‹è¯•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ï¸</span>
          æ„å»ºä¸éƒ¨ç½²
        </h3>
        <ul class="category-docs">
          <li><a href="29-é¡¹ç›®æ„å»º.html" class="doc-link">é¡¹ç›®æ„å»º</a></li><li><a href="30-ç”Ÿäº§éƒ¨ç½².html" class="doc-link">ç”Ÿäº§éƒ¨ç½²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ› ï¸</span>
          å¼€å‘å·¥å…·
        </h3>
        <ul class="category-docs">
          <li><a href="31-å¼€å‘è€…å·¥å…·.html" class="doc-link">å¼€å‘è€…å·¥å…·</a></li><li><a href="32-è°ƒè¯•æŠ€å·§.html" class="doc-link">è°ƒè¯•æŠ€å·§</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“–</span>
          APIå‚è€ƒ
        </h3>
        <ul class="category-docs">
          <li><a href="33-React-APIå®Œæ•´å‚è€ƒ.html" class="doc-link">React-APIå®Œæ•´å‚è€ƒ</a></li><li><a href="34-DOMå…ƒç´ å±æ€§.html" class="doc-link">DOMå…ƒç´ å±æ€§</a></li><li><a href="35-åˆæˆäº‹ä»¶.html" class="doc-link">åˆæˆäº‹ä»¶</a></li><li><a href="React-Hookså®Œæ•´å‚è€ƒ.html" class="doc-link">React-Hookså®Œæ•´å‚è€ƒ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ’¡</span>
          æœ€ä½³å®è·µ
        </h3>
        <ul class="category-docs">
          <li><a href="36-ç¼–ç è§„èŒƒ.html" class="doc-link">ç¼–ç è§„èŒƒ</a></li><li><a href="37-é¡¹ç›®æ¶æ„.html" class="doc-link">é¡¹ç›®æ¶æ„</a></li><li><a href="38-å¸¸è§é—®é¢˜.html" class="doc-link">å¸¸è§é—®é¢˜</a></li>
        </ul>
      </div>
          </nav>
        </div>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="content">
        <article class="doc-article">
          <div class="doc-header">
            <div class="breadcrumb">
              <a href="index.html">é¦–é¡µ</a>
              <span class="separator">></span>
              <span class="current">Reduxé›†æˆ</span>
            </div>
            <h1 class="doc-title">Reduxé›†æˆ</h1>
            <div class="doc-meta">
              <span class="category" style="background: #a8edea">
                ğŸ“¦ çŠ¶æ€ç®¡ç†
              </span>
            </div>
          </div>
          
          <div class="doc-content">
            <h1>23-Reduxé›†æˆ</h1>
<p>Reduxæ˜¯Reactåº”ç”¨ä¸­æœ€æµè¡Œçš„çŠ¶æ€ç®¡ç†åº“ä¹‹ä¸€ã€‚å®ƒæä¾›äº†å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤§å‹ã€å¤æ‚çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2>ReduxåŸºç¡€æ¦‚å¿µ</h2>
<h3>æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>Store</strong>: å­˜å‚¨åº”ç”¨çŠ¶æ€çš„åœ°æ–¹</li>
<li><strong>Action</strong>: æè¿°å‘ç”Ÿäº†ä»€ä¹ˆçš„çº¯å¯¹è±¡</li>
<li><strong>Reducer</strong>: æŒ‡å®šåº”ç”¨çŠ¶æ€å¦‚ä½•å“åº”actionçš„å‡½æ•°</li>
<li><strong>Dispatch</strong>: å‘é€actionçš„æ–¹æ³•</li>
</ul>
<h3>æ•°æ®æµ</h3>
<pre><code>View -&gt; Action -&gt; Reducer -&gt; Store -&gt; View
</code></pre>
<h2>ç¯å¢ƒæ­å»º</h2>
<h3>å®‰è£…ä¾èµ–</h3>
<pre><code class="language-bash"># Redux Toolkit (æ¨è)
npm install @reduxjs/toolkit react-redux

# æˆ–ä¼ ç»ŸRedux
npm install redux react-redux
</code></pre>
<h3>åŸºç¡€é…ç½®</h3>
<pre><code class="language-jsx">// store.js
import { configureStore } from &#39;@reduxjs/toolkit&#39;;
import counterReducer from &#39;./features/counter/counterSlice&#39;;

export const store = configureStore({
  reducer: {
    counter: counterReducer,
  },
});

export type RootState = ReturnType&lt;typeof store.getState&gt;;
export type AppDispatch = typeof store.dispatch;
</code></pre>
<pre><code class="language-jsx">// index.js
import React from &#39;react&#39;;
import ReactDOM from &#39;react-dom/client&#39;;
import { Provider } from &#39;react-redux&#39;;
import { store } from &#39;./store&#39;;
import App from &#39;./App&#39;;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;));
root.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;
);
</code></pre>
<h2>Redux Toolkit (RTK)</h2>
<h3>åˆ›å»ºSlice</h3>
<pre><code class="language-jsx">// features/counter/counterSlice.js
import { createSlice } from &#39;@reduxjs/toolkit&#39;;

const initialState = {
  value: 0,
  loading: false,
  error: null
};

export const counterSlice = createSlice({
  name: &#39;counter&#39;,
  initialState,
  reducers: {
    increment: (state) =&gt; {
      state.value += 1;
    },
    decrement: (state) =&gt; {
      state.value -= 1;
    },
    incrementByAmount: (state, action) =&gt; {
      state.value += action.payload;
    },
    reset: (state) =&gt; {
      state.value = 0;
    }
  }
});

export const { increment, decrement, incrementByAmount, reset } = counterSlice.actions;
export default counterSlice.reducer;
</code></pre>
<h3>å¼‚æ­¥Action (createAsyncThunk)</h3>
<pre><code class="language-jsx">// features/posts/postsSlice.js
import { createSlice, createAsyncThunk } from &#39;@reduxjs/toolkit&#39;;

// å¼‚æ­¥thunk
export const fetchPosts = createAsyncThunk(
  &#39;posts/fetchPosts&#39;,
  async (_, { rejectWithValue }) =&gt; {
    try {
      const response = await fetch(&#39;/api/posts&#39;);
      if (!response.ok) {
        throw new Error(&#39;Failed to fetch posts&#39;);
      }
      return await response.json();
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

export const createPost = createAsyncThunk(
  &#39;posts/createPost&#39;,
  async (postData, { rejectWithValue }) =&gt; {
    try {
      const response = await fetch(&#39;/api/posts&#39;, {
        method: &#39;POST&#39;,
        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },
        body: JSON.stringify(postData)
      });
      
      if (!response.ok) {
        throw new Error(&#39;Failed to create post&#39;);
      }
      
      return await response.json();
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

const postsSlice = createSlice({
  name: &#39;posts&#39;,
  initialState: {
    items: [],
    loading: false,
    error: null,
    currentPage: 1,
    totalPages: 1
  },
  reducers: {
    clearError: (state) =&gt; {
      state.error = null;
    },
    setCurrentPage: (state, action) =&gt; {
      state.currentPage = action.payload;
    }
  },
  extraReducers: (builder) =&gt; {
    builder
      // fetchPosts
      .addCase(fetchPosts.pending, (state) =&gt; {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchPosts.fulfilled, (state, action) =&gt; {
        state.loading = false;
        state.items = action.payload.posts;
        state.totalPages = action.payload.totalPages;
      })
      .addCase(fetchPosts.rejected, (state, action) =&gt; {
        state.loading = false;
        state.error = action.payload;
      })
      // createPost
      .addCase(createPost.pending, (state) =&gt; {
        state.loading = true;
      })
      .addCase(createPost.fulfilled, (state, action) =&gt; {
        state.loading = false;
        state.items.unshift(action.payload);
      })
      .addCase(createPost.rejected, (state, action) =&gt; {
        state.loading = false;
        state.error = action.payload;
      });
  }
});

export const { clearError, setCurrentPage } = postsSlice.actions;
export default postsSlice.reducer;
</code></pre>
<h2>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</h2>
<h3>useSelectorå’ŒuseDispatch</h3>
<pre><code class="language-jsx">// components/Counter.jsx
import React from &#39;react&#39;;
import { useSelector, useDispatch } from &#39;react-redux&#39;;
import { increment, decrement, incrementByAmount, reset } from &#39;../features/counter/counterSlice&#39;;

function Counter() {
  const count = useSelector((state) =&gt; state.counter.value);
  const dispatch = useDispatch();

  return (
    &lt;div&gt;
      &lt;h2&gt;è®¡æ•°å™¨: {count}&lt;/h2&gt;
      &lt;div&gt;
        &lt;button onClick={() =&gt; dispatch(increment())}&gt;
          +1
        &lt;/button&gt;
        &lt;button onClick={() =&gt; dispatch(decrement())}&gt;
          -1
        &lt;/button&gt;
        &lt;button onClick={() =&gt; dispatch(incrementByAmount(5))}&gt;
          +5
        &lt;/button&gt;
        &lt;button onClick={() =&gt; dispatch(reset())}&gt;
          é‡ç½®
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default Counter;
</code></pre>
<h3>å¼‚æ­¥æ“ä½œç»„ä»¶</h3>
<pre><code class="language-jsx">// components/PostsList.jsx
import React, { useEffect, useState } from &#39;react&#39;;
import { useSelector, useDispatch } from &#39;react-redux&#39;;
import { fetchPosts, createPost, clearError } from &#39;../features/posts/postsSlice&#39;;

function PostsList() {
  const dispatch = useDispatch();
  const { items: posts, loading, error } = useSelector((state) =&gt; state.posts);
  const [newPostTitle, setNewPostTitle] = useState(&#39;&#39;);

  useEffect(() =&gt; {
    dispatch(fetchPosts());
  }, [dispatch]);

  const handleCreatePost = (e) =&gt; {
    e.preventDefault();
    if (newPostTitle.trim()) {
      dispatch(createPost({
        title: newPostTitle,
        content: &#39;æ–°æ–‡ç« å†…å®¹...&#39;
      }));
      setNewPostTitle(&#39;&#39;);
    }
  };

  if (loading) return &lt;div&gt;åŠ è½½ä¸­...&lt;/div&gt;;

  return (
    &lt;div&gt;
      &lt;h2&gt;æ–‡ç« åˆ—è¡¨&lt;/h2&gt;
      
      {error &amp;&amp; (
        &lt;div className=&quot;error&quot;&gt;
          é”™è¯¯: {error}
          &lt;button onClick={() =&gt; dispatch(clearError())}&gt;
            æ¸…é™¤é”™è¯¯
          &lt;/button&gt;
        &lt;/div&gt;
      )}

      &lt;form onSubmit={handleCreatePost}&gt;
        &lt;input
          type=&quot;text&quot;
          value={newPostTitle}
          onChange={(e) =&gt; setNewPostTitle(e.target.value)}
          placeholder=&quot;æ–‡ç« æ ‡é¢˜&quot;
        /&gt;
        &lt;button type=&quot;submit&quot;&gt;åˆ›å»ºæ–‡ç« &lt;/button&gt;
      &lt;/form&gt;

      &lt;ul&gt;
        {posts.map(post =&gt; (
          &lt;li key={post.id}&gt;
            &lt;h3&gt;{post.title}&lt;/h3&gt;
            &lt;p&gt;{post.content}&lt;/p&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}

export default PostsList;
</code></pre>
<h2>è‡ªå®šä¹‰Hooks</h2>
<h3>ç±»å‹å®‰å…¨çš„Hooks</h3>
<pre><code class="language-jsx">// hooks/redux.js
import { useDispatch, useSelector, TypedUseSelectorHook } from &#39;react-redux&#39;;
import type { RootState, AppDispatch } from &#39;../store&#39;;

export const useAppDispatch = () =&gt; useDispatch&lt;AppDispatch&gt;();
export const useAppSelector: TypedUseSelectorHook&lt;RootState&gt; = useSelector;
</code></pre>
<h3>ä¸šåŠ¡é€»è¾‘Hooks</h3>
<pre><code class="language-jsx">// hooks/usePosts.js
import { useEffect } from &#39;react&#39;;
import { useAppSelector, useAppDispatch } from &#39;./redux&#39;;
import { fetchPosts, createPost, setCurrentPage } from &#39;../features/posts/postsSlice&#39;;

export function usePosts() {
  const dispatch = useAppDispatch();
  const posts = useAppSelector((state) =&gt; state.posts);

  const loadPosts = (page = 1) =&gt; {
    dispatch(setCurrentPage(page));
    dispatch(fetchPosts({ page }));
  };

  const addPost = (postData) =&gt; {
    return dispatch(createPost(postData));
  };

  useEffect(() =&gt; {
    if (posts.items.length === 0) {
      loadPosts();
    }
  }, []);

  return {
    posts: posts.items,
    loading: posts.loading,
    error: posts.error,
    currentPage: posts.currentPage,
    totalPages: posts.totalPages,
    loadPosts,
    addPost
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function PostsComponent() {
  const { posts, loading, error, loadPosts, addPost } = usePosts();

  if (loading) return &lt;div&gt;åŠ è½½ä¸­...&lt;/div&gt;;
  if (error) return &lt;div&gt;é”™è¯¯: {error}&lt;/div&gt;;

  return (
    &lt;div&gt;
      {posts.map(post =&gt; (
        &lt;div key={post.id}&gt;{post.title}&lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
}
</code></pre>
<h2>å¤æ‚çŠ¶æ€ç®¡ç†</h2>
<h3>ç”¨æˆ·è®¤è¯</h3>
<pre><code class="language-jsx">// features/auth/authSlice.js
import { createSlice, createAsyncThunk } from &#39;@reduxjs/toolkit&#39;;

export const loginUser = createAsyncThunk(
  &#39;auth/loginUser&#39;,
  async ({ email, password }, { rejectWithValue }) =&gt; {
    try {
      const response = await fetch(&#39;/api/auth/login&#39;, {
        method: &#39;POST&#39;,
        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },
        body: JSON.stringify({ email, password })
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message);
      }

      const data = await response.json();
      localStorage.setItem(&#39;token&#39;, data.token);
      return data;
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

export const logoutUser = createAsyncThunk(
  &#39;auth/logoutUser&#39;,
  async (_, { dispatch }) =&gt; {
    localStorage.removeItem(&#39;token&#39;);
    dispatch(clearUserData());
  }
);

export const checkAuthStatus = createAsyncThunk(
  &#39;auth/checkAuthStatus&#39;,
  async (_, { rejectWithValue }) =&gt; {
    try {
      const token = localStorage.getItem(&#39;token&#39;);
      if (!token) {
        throw new Error(&#39;No token found&#39;);
      }

      const response = await fetch(&#39;/api/auth/me&#39;, {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!response.ok) {
        throw new Error(&#39;Token invalid&#39;);
      }

      return await response.json();
    } catch (error) {
      localStorage.removeItem(&#39;token&#39;);
      return rejectWithValue(error.message);
    }
  }
);

const authSlice = createSlice({
  name: &#39;auth&#39;,
  initialState: {
    user: null,
    token: localStorage.getItem(&#39;token&#39;),
    loading: false,
    error: null,
    isAuthenticated: false
  },
  reducers: {
    clearError: (state) =&gt; {
      state.error = null;
    },
    clearUserData: (state) =&gt; {
      state.user = null;
      state.token = null;
      state.isAuthenticated = false;
    }
  },
  extraReducers: (builder) =&gt; {
    builder
      // login
      .addCase(loginUser.pending, (state) =&gt; {
        state.loading = true;
        state.error = null;
      })
      .addCase(loginUser.fulfilled, (state, action) =&gt; {
        state.loading = false;
        state.user = action.payload.user;
        state.token = action.payload.token;
        state.isAuthenticated = true;
      })
      .addCase(loginUser.rejected, (state, action) =&gt; {
        state.loading = false;
        state.error = action.payload;
      })
      // check auth
      .addCase(checkAuthStatus.fulfilled, (state, action) =&gt; {
        state.user = action.payload;
        state.isAuthenticated = true;
      })
      .addCase(checkAuthStatus.rejected, (state) =&gt; {
        state.token = null;
        state.isAuthenticated = false;
      });
  }
});

export const { clearError, clearUserData } = authSlice.actions;
export default authSlice.reducer;
</code></pre>
<h3>è´­ç‰©è½¦ç®¡ç†</h3>
<pre><code class="language-jsx">// features/cart/cartSlice.js
import { createSlice } from &#39;@reduxjs/toolkit&#39;;

const cartSlice = createSlice({
  name: &#39;cart&#39;,
  initialState: {
    items: [],
    total: 0,
    itemCount: 0
  },
  reducers: {
    addItem: (state, action) =&gt; {
      const newItem = action.payload;
      const existingItem = state.items.find(item =&gt; item.id === newItem.id);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        state.items.push({ ...newItem, quantity: 1 });
      }

      state.itemCount += 1;
      state.total += newItem.price;
    },
    removeItem: (state, action) =&gt; {
      const id = action.payload;
      const existingItem = state.items.find(item =&gt; item.id === id);

      if (existingItem) {
        state.total -= existingItem.price * existingItem.quantity;
        state.itemCount -= existingItem.quantity;
        state.items = state.items.filter(item =&gt; item.id !== id);
      }
    },
    updateQuantity: (state, action) =&gt; {
      const { id, quantity } = action.payload;
      const existingItem = state.items.find(item =&gt; item.id === id);

      if (existingItem &amp;&amp; quantity &gt; 0) {
        const quantityDiff = quantity - existingItem.quantity;
        existingItem.quantity = quantity;
        state.itemCount += quantityDiff;
        state.total += existingItem.price * quantityDiff;
      } else if (existingItem &amp;&amp; quantity === 0) {
        state.total -= existingItem.price * existingItem.quantity;
        state.itemCount -= existingItem.quantity;
        state.items = state.items.filter(item =&gt; item.id !== id);
      }
    },
    clearCart: (state) =&gt; {
      state.items = [];
      state.total = 0;
      state.itemCount = 0;
    }
  }
});

export const { addItem, removeItem, updateQuantity, clearCart } = cartSlice.actions;
export default cartSlice.reducer;
</code></pre>
<h2>ä¸­é—´ä»¶</h2>
<h3>Redux Logger</h3>
<pre><code class="language-jsx">// store.js
import { configureStore } from &#39;@reduxjs/toolkit&#39;;
import logger from &#39;redux-logger&#39;;

export const store = configureStore({
  reducer: {
    // reducers
  },
  middleware: (getDefaultMiddleware) =&gt;
    getDefaultMiddleware().concat(logger),
  devTools: process.env.NODE_ENV !== &#39;production&#39;
});
</code></pre>
<h3>è‡ªå®šä¹‰ä¸­é—´ä»¶</h3>
<pre><code class="language-jsx">// middleware/errorMiddleware.js
export const errorMiddleware = (store) =&gt; (next) =&gt; (action) =&gt; {
  try {
    return next(action);
  } catch (error) {
    console.error(&#39;Redux Error:&#39;, error);
    // å¯ä»¥dispatché”™è¯¯action
    store.dispatch({
      type: &#39;global/setError&#39;,
      payload: error.message
    });
    throw error;
  }
};

// middleware/analyticsMiddleware.js
export const analyticsMiddleware = (store) =&gt; (next) =&gt; (action) =&gt; {
  // è®°å½•ç‰¹å®šactionsçš„åˆ†ææ•°æ®
  const analyticsActions = [&#39;user/login&#39;, &#39;cart/addItem&#39;, &#39;order/complete&#39;];
  
  if (analyticsActions.includes(action.type)) {
    // å‘é€åˆ†ææ•°æ®
    analytics.track(action.type, action.payload);
  }

  return next(action);
};
</code></pre>
<h2>RTK Query</h2>
<h3>é…ç½®API</h3>
<pre><code class="language-jsx">// services/api.js
import { createApi, fetchBaseQuery } from &#39;@reduxjs/toolkit/query/react&#39;;

export const api = createApi({
  reducerPath: &#39;api&#39;,
  baseQuery: fetchBaseQuery({
    baseUrl: &#39;/api/&#39;,
    prepareHeaders: (headers, { getState }) =&gt; {
      const token = getState().auth.token;
      if (token) {
        headers.set(&#39;authorization&#39;, `Bearer ${token}`);
      }
      return headers;
    },
  }),
  tagTypes: [&#39;Post&#39;, &#39;User&#39;],
  endpoints: (builder) =&gt; ({
    // æŸ¥è¯¢
    getPosts: builder.query({
      query: ({ page = 1, limit = 10 } = {}) =&gt; 
        `posts?page=${page}&amp;limit=${limit}`,
      providesTags: [&#39;Post&#39;]
    }),
    getPost: builder.query({
      query: (id) =&gt; `posts/${id}`,
      providesTags: (result, error, id) =&gt; [{ type: &#39;Post&#39;, id }]
    }),
    // å˜æ›´
    createPost: builder.mutation({
      query: (newPost) =&gt; ({
        url: &#39;posts&#39;,
        method: &#39;POST&#39;,
        body: newPost
      }),
      invalidatesTags: [&#39;Post&#39;]
    }),
    updatePost: builder.mutation({
      query: ({ id, ...patch }) =&gt; ({
        url: `posts/${id}`,
        method: &#39;PATCH&#39;,
        body: patch
      }),
      invalidatesTags: (result, error, { id }) =&gt; [{ type: &#39;Post&#39;, id }]
    }),
    deletePost: builder.mutation({
      query: (id) =&gt; ({
        url: `posts/${id}`,
        method: &#39;DELETE&#39;
      }),
      invalidatesTags: [&#39;Post&#39;]
    })
  })
});

export const {
  useGetPostsQuery,
  useGetPostQuery,
  useCreatePostMutation,
  useUpdatePostMutation,
  useDeletePostMutation
} = api;
</code></pre>
<h3>ä½¿ç”¨RTK Query</h3>
<pre><code class="language-jsx">// components/PostsWithRTK.jsx
import React, { useState } from &#39;react&#39;;
import {
  useGetPostsQuery,
  useCreatePostMutation,
  useDeletePostMutation
} from &#39;../services/api&#39;;

function PostsWithRTK() {
  const [page, setPage] = useState(1);
  const { 
    data: postsData, 
    error, 
    isLoading, 
    isFetching 
  } = useGetPostsQuery({ page });

  const [createPost, { isLoading: isCreating }] = useCreatePostMutation();
  const [deletePost] = useDeletePostMutation();

  const handleCreatePost = async () =&gt; {
    try {
      await createPost({
        title: &#39;æ–°æ–‡ç« &#39;,
        content: &#39;æ–‡ç« å†…å®¹&#39;
      }).unwrap();
    } catch (error) {
      console.error(&#39;åˆ›å»ºå¤±è´¥:&#39;, error);
    }
  };

  const handleDeletePost = async (id) =&gt; {
    try {
      await deletePost(id).unwrap();
    } catch (error) {
      console.error(&#39;åˆ é™¤å¤±è´¥:&#39;, error);
    }
  };

  if (isLoading) return &lt;div&gt;åŠ è½½ä¸­...&lt;/div&gt;;
  if (error) return &lt;div&gt;é”™è¯¯: {error.message}&lt;/div&gt;;

  return (
    &lt;div&gt;
      &lt;div&gt;
        &lt;button onClick={handleCreatePost} disabled={isCreating}&gt;
          {isCreating ? &#39;åˆ›å»ºä¸­...&#39; : &#39;åˆ›å»ºæ–‡ç« &#39;}
        &lt;/button&gt;
        {isFetching &amp;&amp; &lt;span&gt;åˆ·æ–°ä¸­...&lt;/span&gt;}
      &lt;/div&gt;

      &lt;ul&gt;
        {postsData?.posts.map(post =&gt; (
          &lt;li key={post.id}&gt;
            &lt;h3&gt;{post.title}&lt;/h3&gt;
            &lt;p&gt;{post.content}&lt;/p&gt;
            &lt;button onClick={() =&gt; handleDeletePost(post.id)}&gt;
              åˆ é™¤
            &lt;/button&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;

      &lt;div&gt;
        &lt;button 
          onClick={() =&gt; setPage(p =&gt; Math.max(1, p - 1))}
          disabled={page === 1}
        &gt;
          ä¸Šä¸€é¡µ
        &lt;/button&gt;
        &lt;span&gt;ç¬¬ {page} é¡µ&lt;/span&gt;
        &lt;button 
          onClick={() =&gt; setPage(p =&gt; p + 1)}
          disabled={!postsData?.hasMore}
        &gt;
          ä¸‹ä¸€é¡µ
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default PostsWithRTK;
</code></pre>
<h2>æµ‹è¯•</h2>
<h3>æµ‹è¯•Reducers</h3>
<pre><code class="language-jsx">// features/counter/counterSlice.test.js
import counterReducer, { increment, decrement, incrementByAmount } from &#39;./counterSlice&#39;;

describe(&#39;counter reducer&#39;, () =&gt; {
  const initialState = {
    value: 0,
    loading: false,
    error: null
  };

  it(&#39;should handle initial state&#39;, () =&gt; {
    expect(counterReducer(undefined, { type: &#39;unknown&#39; })).toEqual(initialState);
  });

  it(&#39;should handle increment&#39;, () =&gt; {
    const actual = counterReducer(initialState, increment());
    expect(actual.value).toEqual(1);
  });

  it(&#39;should handle decrement&#39;, () =&gt; {
    const actual = counterReducer(initialState, decrement());
    expect(actual.value).toEqual(-1);
  });

  it(&#39;should handle incrementByAmount&#39;, () =&gt; {
    const actual = counterReducer(initialState, incrementByAmount(2));
    expect(actual.value).toEqual(2);
  });
});
</code></pre>
<h3>æµ‹è¯•ç»„ä»¶</h3>
<pre><code class="language-jsx">// components/Counter.test.jsx
import React from &#39;react&#39;;
import { render, screen, fireEvent } from &#39;@testing-library/react&#39;;
import { Provider } from &#39;react-redux&#39;;
import { configureStore } from &#39;@reduxjs/toolkit&#39;;
import counterReducer from &#39;../features/counter/counterSlice&#39;;
import Counter from &#39;./Counter&#39;;

function renderWithProviders(
  ui,
  {
    preloadedState = {},
    store = configureStore({
      reducer: { counter: counterReducer },
      preloadedState
    }),
    ...renderOptions
  } = {}
) {
  function Wrapper({ children }) {
    return &lt;Provider store={store}&gt;{children}&lt;/Provider&gt;;
  }
  return { store, ...render(ui, { wrapper: Wrapper, ...renderOptions }) };
}

describe(&#39;Counter component&#39;, () =&gt; {
  it(&#39;renders with initial value&#39;, () =&gt; {
    renderWithProviders(&lt;Counter /&gt;);
    expect(screen.getByText(&#39;è®¡æ•°å™¨: 0&#39;)).toBeInTheDocument();
  });

  it(&#39;increments value when plus button is clicked&#39;, () =&gt; {
    renderWithProviders(&lt;Counter /&gt;);
    
    fireEvent.click(screen.getByText(&#39;+1&#39;));
    expect(screen.getByText(&#39;è®¡æ•°å™¨: 1&#39;)).toBeInTheDocument();
  });

  it(&#39;decrements value when minus button is clicked&#39;, () =&gt; {
    renderWithProviders(&lt;Counter /&gt;);
    
    fireEvent.click(screen.getByText(&#39;-1&#39;));
    expect(screen.getByText(&#39;è®¡æ•°å™¨: -1&#39;)).toBeInTheDocument();
  });
});
</code></pre>
<h2>æœ€ä½³å®è·µ</h2>
<h3>çŠ¶æ€ç»“æ„è®¾è®¡</h3>
<pre><code class="language-jsx">// âœ… å¥½çš„çŠ¶æ€ç»“æ„
{
  entities: {
    users: {
      byId: {
        1: { id: 1, name: &#39;John&#39; },
        2: { id: 2, name: &#39;Jane&#39; }
      },
      allIds: [1, 2]
    },
    posts: {
      byId: {
        1: { id: 1, title: &#39;Post 1&#39;, userId: 1 },
        2: { id: 2, title: &#39;Post 2&#39;, userId: 2 }
      },
      allIds: [1, 2]
    }
  },
  ui: {
    currentUserId: 1,
    loading: false,
    error: null
  }
}

// âŒ é¿å…çš„çŠ¶æ€ç»“æ„
{
  users: [
    { 
      id: 1, 
      name: &#39;John&#39;,
      posts: [{ id: 1, title: &#39;Post 1&#39; }] // åµŒå¥—æ•°æ®
    }
  ],
  loading: false,
  error: null
}
</code></pre>
<h3>Selectorä¼˜åŒ–</h3>
<pre><code class="language-jsx">// selectors/postsSelectors.js
import { createSelector } from &#39;@reduxjs/toolkit&#39;;

// åŸºç¡€selectors
const selectPosts = (state) =&gt; state.posts.entities;
const selectPostIds = (state) =&gt; state.posts.ids;
const selectUsers = (state) =&gt; state.users.entities;

// è®°å¿†åŒ–selectors
export const selectAllPosts = createSelector(
  [selectPosts, selectPostIds],
  (posts, postIds) =&gt; postIds.map(id =&gt; posts[id])
);

export const selectPostsByUser = createSelector(
  [selectAllPosts, (state, userId) =&gt; userId],
  (posts, userId) =&gt; posts.filter(post =&gt; post.userId === userId)
);

export const selectPostsWithAuthors = createSelector(
  [selectAllPosts, selectUsers],
  (posts, users) =&gt; posts.map(post =&gt; ({
    ...post,
    author: users[post.userId]
  }))
);
</code></pre>
<h2>æ€»ç»“</h2>
<p>Redux/Redux Toolkitçš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol>
<li><strong>çŠ¶æ€ç®¡ç†</strong>: é›†ä¸­ç®¡ç†åº”ç”¨çŠ¶æ€</li>
<li><strong>å¯é¢„æµ‹æ€§</strong>: çº¯å‡½æ•°å’Œä¸å¯å˜æ›´æ–°</li>
<li><strong>è°ƒè¯•å‹å¥½</strong>: æ—¶é—´æ—…è¡Œè°ƒè¯•</li>
<li><strong>ç”Ÿæ€ç³»ç»Ÿ</strong>: ä¸°å¯Œçš„ä¸­é—´ä»¶å’Œå·¥å…·</li>
</ol>
<p>ä½¿ç”¨å»ºè®®ï¼š</p>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨Redux Toolkitè€ŒéåŸç”ŸRedux</li>
<li>åˆç†è®¾è®¡çŠ¶æ€ç»“æ„ï¼Œé¿å…è¿‡åº¦åµŒå¥—</li>
<li>ä½¿ç”¨RTK Queryå¤„ç†æœåŠ¡å™¨çŠ¶æ€</li>
<li>ç¼–å†™å……åˆ†çš„æµ‹è¯•</li>
</ul>
<p>Reduxé€‚ç”¨äºéœ€è¦å¤æ‚çŠ¶æ€ç®¡ç†çš„å¤§å‹åº”ç”¨ï¼Œå¯¹äºç®€å•åº”ç”¨å¯ä»¥è€ƒè™‘ä½¿ç”¨Context APIæˆ–å…¶ä»–è½»é‡çº§çŠ¶æ€ç®¡ç†æ–¹æ¡ˆã€‚ </p>

          </div>

          <!-- æ–‡æ¡£å¯¼èˆª -->
          <div class="doc-navigation">
            
              <a href="22-Context-API.html" class="nav-btn prev-btn">
                <span class="nav-icon">â†</span>
                <div class="nav-text">
                  <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                  <span class="nav-title">Context-API</span>
                </div>
              </a>
            
            
            
              <a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="nav-btn next-btn">
                <div class="nav-text">
                  <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                  <span class="nav-title">ZustandçŠ¶æ€ç®¡ç†</span>
                </div>
                <span class="nav-icon">â†’</span>
              </a>
            
          </div>
        </article>
      </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <span>â†‘</span>
    </button>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 React ä¸­æ–‡æ–‡æ¡£. åŸºäº React 18.x æ„å»º</p>
        <p>Made with â¤ï¸ by Reactä¸­æ–‡ç¤¾åŒº</p>
      </div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>