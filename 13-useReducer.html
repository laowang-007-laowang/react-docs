<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>useReducer - React ä¸­æ–‡æ–‡æ¡£</title>
  <meta name="description" content="ä»å…¥é—¨åˆ°ç²¾é€šï¼Œå…¨é¢æŒæ¡Reactå¼€å‘æŠ€èƒ½">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/highlight.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">âš›ï¸</span>
          <div class="logo-text">
            <h1>React ä¸­æ–‡æ–‡æ¡£</h1>
            <p>ç°ä»£åŒ–çš„Reactå­¦ä¹ æŒ‡å—</p>
          </div>
        </div>
        <nav class="header-nav">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
          <a href="#" class="nav-link" onclick="toggleSidebar()">ç›®å½•</a>
          <a href="https://github.com/facebook/react" target="_blank" class="nav-link">GitHub</a>
        </nav>
      </div>
    </header>

    <div class="main-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <div class="search-box">
            <input type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput" onkeyup="searchDocs()">
            <span class="search-icon">ğŸ”</span>
          </div>
          <nav class="doc-nav">
            
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“š</span>
          åŸºç¡€æ¦‚å¿µ
        </h3>
        <ul class="category-docs">
          <li><a href="01-Reactç®€ä»‹.html" class="doc-link">Reactç®€ä»‹</a></li><li><a href="02-ç¯å¢ƒæ­å»º.html" class="doc-link">ç¯å¢ƒæ­å»º</a></li><li><a href="03-JSXè¯­æ³•.html" class="doc-link">JSXè¯­æ³•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§©</span>
          ç»„ä»¶å¼€å‘
        </h3>
        <ul class="category-docs">
          <li><a href="04-ç»„ä»¶åŸºç¡€.html" class="doc-link">ç»„ä»¶åŸºç¡€</a></li><li><a href="05-Propsä¸State.html" class="doc-link">Propsä¸State</a></li><li><a href="06-äº‹ä»¶å¤„ç†.html" class="doc-link">äº‹ä»¶å¤„ç†</a></li><li><a href="07-æ¡ä»¶æ¸²æŸ“.html" class="doc-link">æ¡ä»¶æ¸²æŸ“</a></li><li><a href="08-åˆ—è¡¨æ¸²æŸ“.html" class="doc-link">åˆ—è¡¨æ¸²æŸ“</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ£</span>
          Hooks API
        </h3>
        <ul class="category-docs">
          <li><a href="09-Hooksæ¦‚è¿°.html" class="doc-link">Hooksæ¦‚è¿°</a></li><li><a href="10-useState.html" class="doc-link">useState</a></li><li><a href="11-useEffect.html" class="doc-link">useEffect</a></li><li><a href="12-useContext.html" class="doc-link">useContext</a></li><li><a href="13-useReducer.html" class="doc-link">useReducer</a></li><li><a href="14-useMemoå’ŒuseCallback.html" class="doc-link">useMemoå’ŒuseCallback</a></li><li><a href="15-useRef.html" class="doc-link">useRef</a></li><li><a href="16-è‡ªå®šä¹‰Hooks.html" class="doc-link">è‡ªå®šä¹‰Hooks</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ”„</span>
          ç”Ÿå‘½å‘¨æœŸ
        </h3>
        <ul class="category-docs">
          <li><a href="17-ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.html" class="doc-link">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li><li><a href="18-å‰¯ä½œç”¨å¤„ç†.html" class="doc-link">å‰¯ä½œç”¨å¤„ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ¨</span>
          æ ·å¼ä¸UI
        </h3>
        <ul class="category-docs">
          <li><a href="19-æ ·å¼å¤„ç†.html" class="doc-link">æ ·å¼å¤„ç†</a></li><li><a href="20-åŠ¨ç”»æ•ˆæœ.html" class="doc-link">åŠ¨ç”»æ•ˆæœ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ºï¸</span>
          è·¯ç”±ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="21-React-Router.html" class="doc-link">React-Router</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“¦</span>
          çŠ¶æ€ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="22-Context-API.html" class="doc-link">Context-API</a></li><li><a href="23-Reduxé›†æˆ.html" class="doc-link">Reduxé›†æˆ</a></li><li><a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="doc-link">ZustandçŠ¶æ€ç®¡ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸš€</span>
          æ€§èƒ½ä¼˜åŒ–
        </h3>
        <ul class="category-docs">
          <li><a href="25-æ€§èƒ½ä¼˜åŒ–æŠ€å·§.html" class="doc-link">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href="26-ä»£ç åˆ†å‰².html" class="doc-link">ä»£ç åˆ†å‰²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§ª</span>
          æµ‹è¯•
        </h3>
        <ul class="category-docs">
          <li><a href="27-å•å…ƒæµ‹è¯•.html" class="doc-link">å•å…ƒæµ‹è¯•</a></li><li><a href="28-é›†æˆæµ‹è¯•.html" class="doc-link">é›†æˆæµ‹è¯•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ï¸</span>
          æ„å»ºä¸éƒ¨ç½²
        </h3>
        <ul class="category-docs">
          <li><a href="29-é¡¹ç›®æ„å»º.html" class="doc-link">é¡¹ç›®æ„å»º</a></li><li><a href="30-ç”Ÿäº§éƒ¨ç½².html" class="doc-link">ç”Ÿäº§éƒ¨ç½²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ› ï¸</span>
          å¼€å‘å·¥å…·
        </h3>
        <ul class="category-docs">
          <li><a href="31-å¼€å‘è€…å·¥å…·.html" class="doc-link">å¼€å‘è€…å·¥å…·</a></li><li><a href="32-è°ƒè¯•æŠ€å·§.html" class="doc-link">è°ƒè¯•æŠ€å·§</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“–</span>
          APIå‚è€ƒ
        </h3>
        <ul class="category-docs">
          <li><a href="33-React-APIå®Œæ•´å‚è€ƒ.html" class="doc-link">React-APIå®Œæ•´å‚è€ƒ</a></li><li><a href="34-DOMå…ƒç´ å±æ€§.html" class="doc-link">DOMå…ƒç´ å±æ€§</a></li><li><a href="35-åˆæˆäº‹ä»¶.html" class="doc-link">åˆæˆäº‹ä»¶</a></li><li><a href="React-Hookså®Œæ•´å‚è€ƒ.html" class="doc-link">React-Hookså®Œæ•´å‚è€ƒ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ’¡</span>
          æœ€ä½³å®è·µ
        </h3>
        <ul class="category-docs">
          <li><a href="36-ç¼–ç è§„èŒƒ.html" class="doc-link">ç¼–ç è§„èŒƒ</a></li><li><a href="37-é¡¹ç›®æ¶æ„.html" class="doc-link">é¡¹ç›®æ¶æ„</a></li><li><a href="38-å¸¸è§é—®é¢˜.html" class="doc-link">å¸¸è§é—®é¢˜</a></li>
        </ul>
      </div>
          </nav>
        </div>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="content">
        <article class="doc-article">
          <div class="doc-header">
            <div class="breadcrumb">
              <a href="index.html">é¦–é¡µ</a>
              <span class="separator">></span>
              <span class="current">useReducer</span>
            </div>
            <h1 class="doc-title">useReducer</h1>
            <div class="doc-meta">
              <span class="category" style="background: #4facfe">
                ğŸ£ Hooks API
              </span>
            </div>
          </div>
          
          <div class="doc-content">
            <h1>13-useReducer</h1>
<p><code>useReducer</code> æ˜¯React Hooksä¸­ç”¨äºç®¡ç†å¤æ‚çŠ¶æ€é€»è¾‘çš„é’©å­ã€‚å®ƒæ˜¯ <code>useState</code> çš„æ›¿ä»£æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚ç”¨äºçŠ¶æ€é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªçŠ¶æ€ä¾èµ–äºä¹‹å‰çŠ¶æ€çš„åœºæ™¯ã€‚</p>
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>ä»€ä¹ˆæ˜¯useReducer</h3>
<p><code>useReducer</code> æ¥å—ä¸€ä¸ªå½¢å¦‚ <code>(state, action) =&gt; newState</code> çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ <code>dispatch</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-jsx">import React, { useReducer } from &#39;react&#39;;

// Reducerå‡½æ•°
function counterReducer(state, action) {
  switch (action.type) {
    case &#39;increment&#39;:
      return { count: state.count + 1 };
    case &#39;decrement&#39;:
      return { count: state.count - 1 };
    case &#39;reset&#39;:
      return { count: 0 };
    default:
      throw new Error(`Unknown action type: ${action.type}`);
  }
}

function Counter() {
  // ä½¿ç”¨useReducer
  const [state, dispatch] = useReducer(counterReducer, { count: 0 });

  return (
    &lt;div&gt;
      &lt;p&gt;è®¡æ•°: {state.count}&lt;/p&gt;
      &lt;button onClick={() =&gt; dispatch({ type: &#39;increment&#39; })}&gt;
        +1
      &lt;/button&gt;
      &lt;button onClick={() =&gt; dispatch({ type: &#39;decrement&#39; })}&gt;
        -1
      &lt;/button&gt;
      &lt;button onClick={() =&gt; dispatch({ type: &#39;reset&#39; })}&gt;
        é‡ç½®
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>åŸºæœ¬è¯­æ³•</h2>
<pre><code class="language-jsx">const [state, dispatch] = useReducer(reducer, initialArg, init);
</code></pre>
<ul>
<li><strong>reducer</strong>: <code>(state, action) =&gt; newState</code> çš„å‡½æ•°</li>
<li><strong>initialArg</strong>: åˆå§‹stateçš„å€¼</li>
<li><strong>init</strong>: å¯é€‰çš„åˆå§‹åŒ–å‡½æ•°</li>
</ul>
<h2>å¤æ‚çŠ¶æ€ç®¡ç†</h2>
<h3>å¤šå­—æ®µçŠ¶æ€</h3>
<pre><code class="language-jsx">const initialState = {
  name: &#39;&#39;,
  email: &#39;&#39;,
  age: 0,
  errors: {},
  isSubmitting: false
};

function formReducer(state, action) {
  switch (action.type) {
    case &#39;SET_FIELD&#39;:
      return {
        ...state,
        [action.field]: action.value,
        errors: {
          ...state.errors,
          [action.field]: null // æ¸…é™¤é”™è¯¯
        }
      };
    
    case &#39;SET_ERROR&#39;:
      return {
        ...state,
        errors: {
          ...state.errors,
          [action.field]: action.error
        }
      };
    
    case &#39;SET_SUBMITTING&#39;:
      return {
        ...state,
        isSubmitting: action.isSubmitting
      };
    
    case &#39;RESET_FORM&#39;:
      return initialState;
    
    default:
      return state;
  }
}

function UserForm() {
  const [state, dispatch] = useReducer(formReducer, initialState);

  const handleChange = (field, value) =&gt; {
    dispatch({ type: &#39;SET_FIELD&#39;, field, value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    
    // éªŒè¯
    let hasErrors = false;
    if (!state.name) {
      dispatch({ type: &#39;SET_ERROR&#39;, field: &#39;name&#39;, error: &#39;å§“åæ˜¯å¿…å¡«çš„&#39; });
      hasErrors = true;
    }
    if (!state.email) {
      dispatch({ type: &#39;SET_ERROR&#39;, field: &#39;email&#39;, error: &#39;é‚®ç®±æ˜¯å¿…å¡«çš„&#39; });
      hasErrors = true;
    }

    if (hasErrors) return;

    // æäº¤
    dispatch({ type: &#39;SET_SUBMITTING&#39;, isSubmitting: true });
    try {
      await submitForm(state);
      dispatch({ type: &#39;RESET_FORM&#39; });
    } catch (error) {
      dispatch({ type: &#39;SET_ERROR&#39;, field: &#39;general&#39;, error: &#39;æäº¤å¤±è´¥&#39; });
    } finally {
      dispatch({ type: &#39;SET_SUBMITTING&#39;, isSubmitting: false });
    }
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;div&gt;
        &lt;input
          type=&quot;text&quot;
          placeholder=&quot;å§“å&quot;
          value={state.name}
          onChange={(e) =&gt; handleChange(&#39;name&#39;, e.target.value)}
        /&gt;
        {state.errors.name &amp;&amp; (
          &lt;span className=&quot;error&quot;&gt;{state.errors.name}&lt;/span&gt;
        )}
      &lt;/div&gt;

      &lt;div&gt;
        &lt;input
          type=&quot;email&quot;
          placeholder=&quot;é‚®ç®±&quot;
          value={state.email}
          onChange={(e) =&gt; handleChange(&#39;email&#39;, e.target.value)}
        /&gt;
        {state.errors.email &amp;&amp; (
          &lt;span className=&quot;error&quot;&gt;{state.errors.email}&lt;/span&gt;
        )}
      &lt;/div&gt;

      &lt;div&gt;
        &lt;input
          type=&quot;number&quot;
          placeholder=&quot;å¹´é¾„&quot;
          value={state.age}
          onChange={(e) =&gt; handleChange(&#39;age&#39;, parseInt(e.target.value))}
        /&gt;
      &lt;/div&gt;

      {state.errors.general &amp;&amp; (
        &lt;div className=&quot;error&quot;&gt;{state.errors.general}&lt;/div&gt;
      )}

      &lt;button type=&quot;submit&quot; disabled={state.isSubmitting}&gt;
        {state.isSubmitting ? &#39;æäº¤ä¸­...&#39; : &#39;æäº¤&#39;}
      &lt;/button&gt;
    &lt;/form&gt;
  );
}
</code></pre>
<h2>æƒ°æ€§åˆå§‹åŒ–</h2>
<h3>ä½¿ç”¨initå‡½æ•°</h3>
<pre><code class="language-jsx">function init(initialCount) {
  return {
    count: initialCount,
    history: [initialCount],
    step: 1
  };
}

function counterReducer(state, action) {
  switch (action.type) {
    case &#39;increment&#39;:
      const newCount = state.count + state.step;
      return {
        ...state,
        count: newCount,
        history: [...state.history, newCount]
      };
    
    case &#39;decrement&#39;:
      const decrementedCount = state.count - state.step;
      return {
        ...state,
        count: decrementedCount,
        history: [...state.history, decrementedCount]
      };
    
    case &#39;set_step&#39;:
      return {
        ...state,
        step: action.step
      };
    
    case &#39;reset&#39;:
      return init(action.initialCount);
    
    default:
      return state;
  }
}

function AdvancedCounter({ initialCount = 0 }) {
  const [state, dispatch] = useReducer(counterReducer, initialCount, init);

  return (
    &lt;div&gt;
      &lt;p&gt;å½“å‰å€¼: {state.count}&lt;/p&gt;
      &lt;p&gt;æ­¥é•¿: {state.step}&lt;/p&gt;
      &lt;p&gt;å†å²: {state.history.join(&#39; â†’ &#39;)}&lt;/p&gt;
      
      &lt;div&gt;
        &lt;button onClick={() =&gt; dispatch({ type: &#39;increment&#39; })}&gt;
          +{state.step}
        &lt;/button&gt;
        &lt;button onClick={() =&gt; dispatch({ type: &#39;decrement&#39; })}&gt;
          -{state.step}
        &lt;/button&gt;
      &lt;/div&gt;
      
      &lt;div&gt;
        &lt;label&gt;
          æ­¥é•¿:
          &lt;input
            type=&quot;number&quot;
            value={state.step}
            onChange={(e) =&gt; dispatch({
              type: &#39;set_step&#39;,
              step: parseInt(e.target.value) || 1
            })}
          /&gt;
        &lt;/label&gt;
      &lt;/div&gt;
      
      &lt;button onClick={() =&gt; dispatch({ type: &#39;reset&#39;, initialCount })}&gt;
        é‡ç½®åˆ°åˆå§‹å€¼
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>Todoåº”ç”¨ç¤ºä¾‹</h2>
<pre><code class="language-jsx">const todoReducer = (state, action) =&gt; {
  switch (action.type) {
    case &#39;ADD_TODO&#39;:
      return {
        ...state,
        todos: [
          ...state.todos,
          {
            id: Date.now(),
            text: action.text,
            completed: false,
            createdAt: new Date()
          }
        ]
      };

    case &#39;TOGGLE_TODO&#39;:
      return {
        ...state,
        todos: state.todos.map(todo =&gt;
          todo.id === action.id
            ? { ...todo, completed: !todo.completed }
            : todo
        )
      };

    case &#39;DELETE_TODO&#39;:
      return {
        ...state,
        todos: state.todos.filter(todo =&gt; todo.id !== action.id)
      };

    case &#39;EDIT_TODO&#39;:
      return {
        ...state,
        todos: state.todos.map(todo =&gt;
          todo.id === action.id
            ? { ...todo, text: action.text }
            : todo
        )
      };

    case &#39;SET_FILTER&#39;:
      return {
        ...state,
        filter: action.filter
      };

    case &#39;CLEAR_COMPLETED&#39;:
      return {
        ...state,
        todos: state.todos.filter(todo =&gt; !todo.completed)
      };

    default:
      return state;
  }
};

const initialTodoState = {
  todos: [],
  filter: &#39;all&#39; // &#39;all&#39;, &#39;active&#39;, &#39;completed&#39;
};

function TodoApp() {
  const [state, dispatch] = useReducer(todoReducer, initialTodoState);
  const [inputValue, setInputValue] = useState(&#39;&#39;);

  const addTodo = () =&gt; {
    if (inputValue.trim()) {
      dispatch({ type: &#39;ADD_TODO&#39;, text: inputValue.trim() });
      setInputValue(&#39;&#39;);
    }
  };

  const filteredTodos = state.todos.filter(todo =&gt; {
    if (state.filter === &#39;active&#39;) return !todo.completed;
    if (state.filter === &#39;completed&#39;) return todo.completed;
    return true;
  });

  const activeCount = state.todos.filter(todo =&gt; !todo.completed).length;
  const completedCount = state.todos.filter(todo =&gt; todo.completed).length;

  return (
    &lt;div className=&quot;todo-app&quot;&gt;
      &lt;div className=&quot;todo-input&quot;&gt;
        &lt;input
          type=&quot;text&quot;
          value={inputValue}
          onChange={(e) =&gt; setInputValue(e.target.value)}
          onKeyPress={(e) =&gt; e.key === &#39;Enter&#39; &amp;&amp; addTodo()}
          placeholder=&quot;æ·»åŠ æ–°ä»»åŠ¡...&quot;
        /&gt;
        &lt;button onClick={addTodo}&gt;æ·»åŠ &lt;/button&gt;
      &lt;/div&gt;

      &lt;div className=&quot;todo-filters&quot;&gt;
        {[&#39;all&#39;, &#39;active&#39;, &#39;completed&#39;].map(filter =&gt; (
          &lt;button
            key={filter}
            className={state.filter === filter ? &#39;active&#39; : &#39;&#39;}
            onClick={() =&gt; dispatch({ type: &#39;SET_FILTER&#39;, filter })}
          &gt;
            {filter === &#39;all&#39; ? &#39;å…¨éƒ¨&#39; : filter === &#39;active&#39; ? &#39;æœªå®Œæˆ&#39; : &#39;å·²å®Œæˆ&#39;}
          &lt;/button&gt;
        ))}
      &lt;/div&gt;

      &lt;div className=&quot;todo-stats&quot;&gt;
        &lt;span&gt;æ€»è®¡: {state.todos.length}&lt;/span&gt;
        &lt;span&gt;æœªå®Œæˆ: {activeCount}&lt;/span&gt;
        &lt;span&gt;å·²å®Œæˆ: {completedCount}&lt;/span&gt;
        {completedCount &gt; 0 &amp;&amp; (
          &lt;button onClick={() =&gt; dispatch({ type: &#39;CLEAR_COMPLETED&#39; })}&gt;
            æ¸…é™¤å·²å®Œæˆ
          &lt;/button&gt;
        )}
      &lt;/div&gt;

      &lt;ul className=&quot;todo-list&quot;&gt;
        {filteredTodos.map(todo =&gt; (
          &lt;TodoItem
            key={todo.id}
            todo={todo}
            onToggle={() =&gt; dispatch({ type: &#39;TOGGLE_TODO&#39;, id: todo.id })}
            onDelete={() =&gt; dispatch({ type: &#39;DELETE_TODO&#39;, id: todo.id })}
            onEdit={(text) =&gt; dispatch({ type: &#39;EDIT_TODO&#39;, id: todo.id, text })}
          /&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}

function TodoItem({ todo, onToggle, onDelete, onEdit }) {
  const [isEditing, setIsEditing] = useState(false);
  const [editText, setEditText] = useState(todo.text);

  const handleSave = () =&gt; {
    if (editText.trim() &amp;&amp; editText !== todo.text) {
      onEdit(editText.trim());
    }
    setIsEditing(false);
  };

  const handleCancel = () =&gt; {
    setEditText(todo.text);
    setIsEditing(false);
  };

  return (
    &lt;li className={`todo-item ${todo.completed ? &#39;completed&#39; : &#39;&#39;}`}&gt;
      &lt;input
        type=&quot;checkbox&quot;
        checked={todo.completed}
        onChange={onToggle}
      /&gt;
      
      {isEditing ? (
        &lt;div className=&quot;edit-mode&quot;&gt;
          &lt;input
            type=&quot;text&quot;
            value={editText}
            onChange={(e) =&gt; setEditText(e.target.value)}
            onKeyPress={(e) =&gt; {
              if (e.key === &#39;Enter&#39;) handleSave();
              if (e.key === &#39;Escape&#39;) handleCancel();
            }}
            onBlur={handleSave}
            autoFocus
          /&gt;
        &lt;/div&gt;
      ) : (
        &lt;span
          className=&quot;todo-text&quot;
          onDoubleClick={() =&gt; setIsEditing(true)}
        &gt;
          {todo.text}
        &lt;/span&gt;
      )}
      
      &lt;div className=&quot;todo-actions&quot;&gt;
        {!isEditing &amp;&amp; (
          &lt;button onClick={() =&gt; setIsEditing(true)}&gt;ç¼–è¾‘&lt;/button&gt;
        )}
        &lt;button onClick={onDelete}&gt;åˆ é™¤&lt;/button&gt;
      &lt;/div&gt;
    &lt;/li&gt;
  );
}
</code></pre>
<h2>è´­ç‰©è½¦ç¤ºä¾‹</h2>
<pre><code class="language-jsx">const cartReducer = (state, action) =&gt; {
  switch (action.type) {
    case &#39;ADD_ITEM&#39;:
      const existingItem = state.items.find(item =&gt; item.id === action.product.id);
      
      if (existingItem) {
        return {
          ...state,
          items: state.items.map(item =&gt;
            item.id === action.product.id
              ? { ...item, quantity: item.quantity + 1 }
              : item
          )
        };
      }
      
      return {
        ...state,
        items: [...state.items, { ...action.product, quantity: 1 }]
      };

    case &#39;REMOVE_ITEM&#39;:
      return {
        ...state,
        items: state.items.filter(item =&gt; item.id !== action.id)
      };

    case &#39;UPDATE_QUANTITY&#39;:
      if (action.quantity &lt;= 0) {
        return {
          ...state,
          items: state.items.filter(item =&gt; item.id !== action.id)
        };
      }
      
      return {
        ...state,
        items: state.items.map(item =&gt;
          item.id === action.id
            ? { ...item, quantity: action.quantity }
            : item
        )
      };

    case &#39;CLEAR_CART&#39;:
      return {
        ...state,
        items: []
      };

    case &#39;APPLY_DISCOUNT&#39;:
      return {
        ...state,
        discount: action.discount
      };

    case &#39;SET_SHIPPING&#39;:
      return {
        ...state,
        shipping: action.shipping
      };

    default:
      return state;
  }
};

const initialCartState = {
  items: [],
  discount: 0,
  shipping: 0
};

function ShoppingCart() {
  const [cart, dispatch] = useReducer(cartReducer, initialCartState);

  const subtotal = cart.items.reduce(
    (sum, item) =&gt; sum + item.price * item.quantity,
    0
  );
  
  const discountAmount = subtotal * (cart.discount / 100);
  const total = subtotal - discountAmount + cart.shipping;

  const addItem = (product) =&gt; {
    dispatch({ type: &#39;ADD_ITEM&#39;, product });
  };

  const removeItem = (id) =&gt; {
    dispatch({ type: &#39;REMOVE_ITEM&#39;, id });
  };

  const updateQuantity = (id, quantity) =&gt; {
    dispatch({ type: &#39;UPDATE_QUANTITY&#39;, id, quantity });
  };

  const applyDiscount = (discount) =&gt; {
    dispatch({ type: &#39;APPLY_DISCOUNT&#39;, discount });
  };

  return (
    &lt;div className=&quot;shopping-cart&quot;&gt;
      &lt;h2&gt;è´­ç‰©è½¦&lt;/h2&gt;
      
      {cart.items.length === 0 ? (
        &lt;p&gt;è´­ç‰©è½¦ä¸ºç©º&lt;/p&gt;
      ) : (
        &lt;div&gt;
          {cart.items.map(item =&gt; (
            &lt;div key={item.id} className=&quot;cart-item&quot;&gt;
              &lt;span&gt;{item.name}&lt;/span&gt;
              &lt;span&gt;Â¥{item.price}&lt;/span&gt;
              &lt;div&gt;
                &lt;button onClick={() =&gt; updateQuantity(item.id, item.quantity - 1)}&gt;
                  -
                &lt;/button&gt;
                &lt;span&gt;{item.quantity}&lt;/span&gt;
                &lt;button onClick={() =&gt; updateQuantity(item.id, item.quantity + 1)}&gt;
                  +
                &lt;/button&gt;
              &lt;/div&gt;
              &lt;span&gt;Â¥{(item.price * item.quantity).toFixed(2)}&lt;/span&gt;
              &lt;button onClick={() =&gt; removeItem(item.id)}&gt;åˆ é™¤&lt;/button&gt;
            &lt;/div&gt;
          ))}
          
          &lt;div className=&quot;cart-summary&quot;&gt;
            &lt;div&gt;å°è®¡: Â¥{subtotal.toFixed(2)}&lt;/div&gt;
            {cart.discount &gt; 0 &amp;&amp; (
              &lt;div&gt;æŠ˜æ‰£ ({cart.discount}%): -Â¥{discountAmount.toFixed(2)}&lt;/div&gt;
            )}
            &lt;div&gt;è¿è´¹: Â¥{cart.shipping.toFixed(2)}&lt;/div&gt;
            &lt;div className=&quot;total&quot;&gt;æ€»è®¡: Â¥{total.toFixed(2)}&lt;/div&gt;
          &lt;/div&gt;
          
          &lt;div className=&quot;cart-actions&quot;&gt;
            &lt;button onClick={() =&gt; applyDiscount(10)}&gt;
              åº”ç”¨10%æŠ˜æ‰£
            &lt;/button&gt;
            &lt;button onClick={() =&gt; dispatch({ type: &#39;SET_SHIPPING&#39;, shipping: 15 })}&gt;
              æ·»åŠ è¿è´¹
            &lt;/button&gt;
            &lt;button onClick={() =&gt; dispatch({ type: &#39;CLEAR_CART&#39; })}&gt;
              æ¸…ç©ºè´­ç‰©è½¦
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
      
      {/* ç¤ºä¾‹äº§å“ */}
      &lt;div className=&quot;products&quot;&gt;
        &lt;h3&gt;å•†å“&lt;/h3&gt;
        {[
          { id: 1, name: &#39;ç¬”è®°æœ¬ç”µè„‘&#39;, price: 5999 },
          { id: 2, name: &#39;é¼ æ ‡&#39;, price: 99 },
          { id: 3, name: &#39;é”®ç›˜&#39;, price: 299 }
        ].map(product =&gt; (
          &lt;div key={product.id} className=&quot;product&quot;&gt;
            &lt;span&gt;{product.name} - Â¥{product.price}&lt;/span&gt;
            &lt;button onClick={() =&gt; addItem(product)}&gt;
              åŠ å…¥è´­ç‰©è½¦
            &lt;/button&gt;
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>ä¸useStateçš„å¯¹æ¯”</h2>
<h3>ä½•æ—¶ä½¿ç”¨useReducer</h3>
<pre><code class="language-jsx">// âœ… é€‚åˆuseReducerçš„åœºæ™¯
function ComplexComponent() {
  // å¤æ‚çš„çŠ¶æ€é€»è¾‘
  const [state, dispatch] = useReducer(complexReducer, initialState);

  // å¤šä¸ªç›¸å…³çš„çŠ¶æ€æ›´æ–°
  const handleComplexAction = () =&gt; {
    dispatch({ type: &#39;COMPLEX_ACTION&#39;, payload: data });
  };

  return (
    // ç»„ä»¶JSX
  );
}

// âŒ ç®€å•çŠ¶æ€æ›´é€‚åˆuseState
function SimpleComponent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState(&#39;&#39;);

  return (
    &lt;div&gt;
      &lt;input value={name} onChange={(e) =&gt; setName(e.target.value)} /&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Count: {count}
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h3>è¿ç§»useStateåˆ°useReducer</h3>
<pre><code class="language-jsx">// åŸå§‹çš„useStateå®ç°
function TodoList() {
  const [todos, setTodos] = useState([]);
  const [filter, setFilter] = useState(&#39;all&#39;);

  const addTodo = (text) =&gt; {
    setTodos([...todos, { id: Date.now(), text, completed: false }]);
  };

  const toggleTodo = (id) =&gt; {
    setTodos(todos.map(todo =&gt;
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };

  // ... æ›´å¤šé€»è¾‘
}

// è¿ç§»åˆ°useReducer
function TodoList() {
  const [state, dispatch] = useReducer(todoReducer, initialState);

  const addTodo = (text) =&gt; {
    dispatch({ type: &#39;ADD_TODO&#39;, text });
  };

  const toggleTodo = (id) =&gt; {
    dispatch({ type: &#39;TOGGLE_TODO&#39;, id });
  };

  // ... æ›´ç®€æ´çš„é€»è¾‘
}
</code></pre>
<h2>ç»“åˆContextä½¿ç”¨</h2>
<pre><code class="language-jsx">const TodoContext = createContext();

function TodoProvider({ children }) {
  const [state, dispatch] = useReducer(todoReducer, initialState);

  return (
    &lt;TodoContext.Provider value={{ state, dispatch }}&gt;
      {children}
    &lt;/TodoContext.Provider&gt;
  );
}

function useTodos() {
  const context = useContext(TodoContext);
  if (!context) {
    throw new Error(&#39;useTodos must be used within TodoProvider&#39;);
  }
  return context;
}

// ä½¿ç”¨
function TodoInput() {
  const { dispatch } = useTodos();
  const [text, setText] = useState(&#39;&#39;);

  const handleSubmit = (e) =&gt; {
    e.preventDefault();
    if (text.trim()) {
      dispatch({ type: &#39;ADD_TODO&#39;, text: text.trim() });
      setText(&#39;&#39;);
    }
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;input
        value={text}
        onChange={(e) =&gt; setText(e.target.value)}
        placeholder=&quot;æ·»åŠ æ–°ä»»åŠ¡&quot;
      /&gt;
      &lt;button type=&quot;submit&quot;&gt;æ·»åŠ &lt;/button&gt;
    &lt;/form&gt;
  );
}

function TodoList() {
  const { state } = useTodos();

  return (
    &lt;ul&gt;
      {state.todos.map(todo =&gt; (
        &lt;TodoItem key={todo.id} todo={todo} /&gt;
      ))}
    &lt;/ul&gt;
  );
}
</code></pre>
<h2>TypeScriptæ”¯æŒ</h2>
<pre><code class="language-tsx">// å®šä¹‰çŠ¶æ€ç±»å‹
interface State {
  count: number;
  step: number;
  history: number[];
}

// å®šä¹‰Actionç±»å‹
type Action =
  | { type: &#39;increment&#39; }
  | { type: &#39;decrement&#39; }
  | { type: &#39;set_step&#39;; step: number }
  | { type: &#39;reset&#39;; initialCount: number };

// Reducerå‡½æ•°
const counterReducer = (state: State, action: Action): State =&gt; {
  switch (action.type) {
    case &#39;increment&#39;:
      return {
        ...state,
        count: state.count + state.step,
        history: [...state.history, state.count + state.step]
      };
    case &#39;decrement&#39;:
      return {
        ...state,
        count: state.count - state.step,
        history: [...state.history, state.count - state.step]
      };
    case &#39;set_step&#39;:
      return {
        ...state,
        step: action.step
      };
    case &#39;reset&#39;:
      return {
        count: action.initialCount,
        step: 1,
        history: [action.initialCount]
      };
    default:
      return state;
  }
};

// ç»„ä»¶
function TypedCounter() {
  const [state, dispatch] = useReducer(counterReducer, {
    count: 0,
    step: 1,
    history: [0]
  });

  return (
    &lt;div&gt;
      &lt;p&gt;Count: {state.count}&lt;/p&gt;
      &lt;button onClick={() =&gt; dispatch({ type: &#39;increment&#39; })}&gt;
        +{state.step}
      &lt;/button&gt;
      &lt;button onClick={() =&gt; dispatch({ type: &#39;decrement&#39; })}&gt;
        -{state.step}
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. Reducerå‡½æ•°åº”è¯¥æ˜¯çº¯å‡½æ•°</h3>
<pre><code class="language-jsx">// âœ… æ­£ç¡®ï¼šçº¯å‡½æ•°
function goodReducer(state, action) {
  switch (action.type) {
    case &#39;ADD_ITEM&#39;:
      return {
        ...state,
        items: [...state.items, action.item]
      };
    default:
      return state;
  }
}

// âŒ é”™è¯¯ï¼šæœ‰å‰¯ä½œç”¨
function badReducer(state, action) {
  switch (action.type) {
    case &#39;ADD_ITEM&#39;:
      console.log(&#39;Adding item&#39;); // å‰¯ä½œç”¨
      state.items.push(action.item); // ç›´æ¥ä¿®æ”¹çŠ¶æ€
      return state;
    default:
      return state;
  }
}
</code></pre>
<h3>2. ä½¿ç”¨å¯¹è±¡å±•å¼€å’Œæ•°ç»„æ–¹æ³•</h3>
<pre><code class="language-jsx">function todoReducer(state, action) {
  switch (action.type) {
    case &#39;ADD_TODO&#39;:
      // âœ… åˆ›å»ºæ–°æ•°ç»„
      return {
        ...state,
        todos: [...state.todos, action.todo]
      };
    
    case &#39;UPDATE_TODO&#39;:
      // âœ… ä½¿ç”¨mapåˆ›å»ºæ–°æ•°ç»„
      return {
        ...state,
        todos: state.todos.map(todo =&gt;
          todo.id === action.id
            ? { ...todo, ...action.updates }
            : todo
        )
      };
    
    case &#39;DELETE_TODO&#39;:
      // âœ… ä½¿ç”¨filteråˆ›å»ºæ–°æ•°ç»„
      return {
        ...state,
        todos: state.todos.filter(todo =&gt; todo.id !== action.id)
      };
    
    default:
      return state;
  }
}
</code></pre>
<h3>3. å¤„ç†å¼‚æ­¥æ“ä½œ</h3>
<pre><code class="language-jsx">function asyncReducer(state, action) {
  switch (action.type) {
    case &#39;FETCH_START&#39;:
      return {
        ...state,
        loading: true,
        error: null
      };
    
    case &#39;FETCH_SUCCESS&#39;:
      return {
        ...state,
        loading: false,
        data: action.data
      };
    
    case &#39;FETCH_ERROR&#39;:
      return {
        ...state,
        loading: false,
        error: action.error
      };
    
    default:
      return state;
  }
}

function DataComponent() {
  const [state, dispatch] = useReducer(asyncReducer, {
    data: null,
    loading: false,
    error: null
  });

  const fetchData = async () =&gt; {
    dispatch({ type: &#39;FETCH_START&#39; });
    try {
      const response = await fetch(&#39;/api/data&#39;);
      const data = await response.json();
      dispatch({ type: &#39;FETCH_SUCCESS&#39;, data });
    } catch (error) {
      dispatch({ type: &#39;FETCH_ERROR&#39;, error: error.message });
    }
  };

  return (
    &lt;div&gt;
      {state.loading &amp;&amp; &lt;p&gt;åŠ è½½ä¸­...&lt;/p&gt;}
      {state.error &amp;&amp; &lt;p&gt;é”™è¯¯: {state.error}&lt;/p&gt;}
      {state.data &amp;&amp; &lt;pre&gt;{JSON.stringify(state.data, null, 2)}&lt;/pre&gt;}
      &lt;button onClick={fetchData}&gt;è·å–æ•°æ®&lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>æ€»ç»“</h2>
<p><code>useReducer</code> æ˜¯ç®¡ç†å¤æ‚çŠ¶æ€çš„å¼ºå¤§å·¥å…·ï¼š</p>
<ol>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤æ‚çŠ¶æ€é€»è¾‘ã€å¤šä¸ªç›¸å…³çŠ¶æ€ã€çŠ¶æ€ä¾èµ–å…³ç³»</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šå¯é¢„æµ‹çš„çŠ¶æ€æ›´æ–°ã€æ›´å¥½çš„æµ‹è¯•æ€§ã€çŠ¶æ€é€»è¾‘é›†ä¸­ç®¡ç†</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šä¿æŒreducerçº¯å‡€ã€ä½¿ç”¨TypeScriptã€ç»“åˆContextä½¿ç”¨</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºã€åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„</li>
</ol>
<p>æ­£ç¡®ä½¿ç”¨ <code>useReducer</code> å¯ä»¥è®©ä½ çš„Reactåº”ç”¨çŠ¶æ€ç®¡ç†æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ã€‚ </p>

          </div>

          <!-- æ–‡æ¡£å¯¼èˆª -->
          <div class="doc-navigation">
            
              <a href="12-useContext.html" class="nav-btn prev-btn">
                <span class="nav-icon">â†</span>
                <div class="nav-text">
                  <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                  <span class="nav-title">useContext</span>
                </div>
              </a>
            
            
            
              <a href="14-useMemoå’ŒuseCallback.html" class="nav-btn next-btn">
                <div class="nav-text">
                  <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                  <span class="nav-title">useMemoå’ŒuseCallback</span>
                </div>
                <span class="nav-icon">â†’</span>
              </a>
            
          </div>
        </article>
      </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <span>â†‘</span>
    </button>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 React ä¸­æ–‡æ–‡æ¡£. åŸºäº React 18.x æ„å»º</p>
        <p>Made with â¤ï¸ by Reactä¸­æ–‡ç¤¾åŒº</p>
      </div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>