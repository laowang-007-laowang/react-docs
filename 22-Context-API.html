<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Context-API - React ä¸­æ–‡æ–‡æ¡£</title>
  <meta name="description" content="ä»å…¥é—¨åˆ°ç²¾é€šï¼Œå…¨é¢æŒæ¡Reactå¼€å‘æŠ€èƒ½">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/highlight.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">âš›ï¸</span>
          <div class="logo-text">
            <h1>React ä¸­æ–‡æ–‡æ¡£</h1>
            <p>ç°ä»£åŒ–çš„Reactå­¦ä¹ æŒ‡å—</p>
          </div>
        </div>
        <nav class="header-nav">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
          <a href="#" class="nav-link" onclick="toggleSidebar()">ç›®å½•</a>
          <a href="https://github.com/facebook/react" target="_blank" class="nav-link">GitHub</a>
        </nav>
      </div>
    </header>

    <div class="main-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <div class="search-box">
            <input type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput" onkeyup="searchDocs()">
            <span class="search-icon">ğŸ”</span>
          </div>
          <nav class="doc-nav">
            
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“š</span>
          åŸºç¡€æ¦‚å¿µ
        </h3>
        <ul class="category-docs">
          <li><a href="01-Reactç®€ä»‹.html" class="doc-link">Reactç®€ä»‹</a></li><li><a href="02-ç¯å¢ƒæ­å»º.html" class="doc-link">ç¯å¢ƒæ­å»º</a></li><li><a href="03-JSXè¯­æ³•.html" class="doc-link">JSXè¯­æ³•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§©</span>
          ç»„ä»¶å¼€å‘
        </h3>
        <ul class="category-docs">
          <li><a href="04-ç»„ä»¶åŸºç¡€.html" class="doc-link">ç»„ä»¶åŸºç¡€</a></li><li><a href="05-Propsä¸State.html" class="doc-link">Propsä¸State</a></li><li><a href="06-äº‹ä»¶å¤„ç†.html" class="doc-link">äº‹ä»¶å¤„ç†</a></li><li><a href="07-æ¡ä»¶æ¸²æŸ“.html" class="doc-link">æ¡ä»¶æ¸²æŸ“</a></li><li><a href="08-åˆ—è¡¨æ¸²æŸ“.html" class="doc-link">åˆ—è¡¨æ¸²æŸ“</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ£</span>
          Hooks API
        </h3>
        <ul class="category-docs">
          <li><a href="09-Hooksæ¦‚è¿°.html" class="doc-link">Hooksæ¦‚è¿°</a></li><li><a href="10-useState.html" class="doc-link">useState</a></li><li><a href="11-useEffect.html" class="doc-link">useEffect</a></li><li><a href="12-useContext.html" class="doc-link">useContext</a></li><li><a href="13-useReducer.html" class="doc-link">useReducer</a></li><li><a href="14-useMemoå’ŒuseCallback.html" class="doc-link">useMemoå’ŒuseCallback</a></li><li><a href="15-useRef.html" class="doc-link">useRef</a></li><li><a href="16-è‡ªå®šä¹‰Hooks.html" class="doc-link">è‡ªå®šä¹‰Hooks</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ”„</span>
          ç”Ÿå‘½å‘¨æœŸ
        </h3>
        <ul class="category-docs">
          <li><a href="17-ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.html" class="doc-link">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li><li><a href="18-å‰¯ä½œç”¨å¤„ç†.html" class="doc-link">å‰¯ä½œç”¨å¤„ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ¨</span>
          æ ·å¼ä¸UI
        </h3>
        <ul class="category-docs">
          <li><a href="19-æ ·å¼å¤„ç†.html" class="doc-link">æ ·å¼å¤„ç†</a></li><li><a href="20-åŠ¨ç”»æ•ˆæœ.html" class="doc-link">åŠ¨ç”»æ•ˆæœ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ºï¸</span>
          è·¯ç”±ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="21-React-Router.html" class="doc-link">React-Router</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“¦</span>
          çŠ¶æ€ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="22-Context-API.html" class="doc-link">Context-API</a></li><li><a href="23-Reduxé›†æˆ.html" class="doc-link">Reduxé›†æˆ</a></li><li><a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="doc-link">ZustandçŠ¶æ€ç®¡ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸš€</span>
          æ€§èƒ½ä¼˜åŒ–
        </h3>
        <ul class="category-docs">
          <li><a href="25-æ€§èƒ½ä¼˜åŒ–æŠ€å·§.html" class="doc-link">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href="26-ä»£ç åˆ†å‰².html" class="doc-link">ä»£ç åˆ†å‰²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§ª</span>
          æµ‹è¯•
        </h3>
        <ul class="category-docs">
          <li><a href="27-å•å…ƒæµ‹è¯•.html" class="doc-link">å•å…ƒæµ‹è¯•</a></li><li><a href="28-é›†æˆæµ‹è¯•.html" class="doc-link">é›†æˆæµ‹è¯•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ï¸</span>
          æ„å»ºä¸éƒ¨ç½²
        </h3>
        <ul class="category-docs">
          <li><a href="29-é¡¹ç›®æ„å»º.html" class="doc-link">é¡¹ç›®æ„å»º</a></li><li><a href="30-ç”Ÿäº§éƒ¨ç½².html" class="doc-link">ç”Ÿäº§éƒ¨ç½²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ› ï¸</span>
          å¼€å‘å·¥å…·
        </h3>
        <ul class="category-docs">
          <li><a href="31-å¼€å‘è€…å·¥å…·.html" class="doc-link">å¼€å‘è€…å·¥å…·</a></li><li><a href="32-è°ƒè¯•æŠ€å·§.html" class="doc-link">è°ƒè¯•æŠ€å·§</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“–</span>
          APIå‚è€ƒ
        </h3>
        <ul class="category-docs">
          <li><a href="33-React-APIå®Œæ•´å‚è€ƒ.html" class="doc-link">React-APIå®Œæ•´å‚è€ƒ</a></li><li><a href="34-DOMå…ƒç´ å±æ€§.html" class="doc-link">DOMå…ƒç´ å±æ€§</a></li><li><a href="35-åˆæˆäº‹ä»¶.html" class="doc-link">åˆæˆäº‹ä»¶</a></li><li><a href="React-Hookså®Œæ•´å‚è€ƒ.html" class="doc-link">React-Hookså®Œæ•´å‚è€ƒ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ’¡</span>
          æœ€ä½³å®è·µ
        </h3>
        <ul class="category-docs">
          <li><a href="36-ç¼–ç è§„èŒƒ.html" class="doc-link">ç¼–ç è§„èŒƒ</a></li><li><a href="37-é¡¹ç›®æ¶æ„.html" class="doc-link">é¡¹ç›®æ¶æ„</a></li><li><a href="38-å¸¸è§é—®é¢˜.html" class="doc-link">å¸¸è§é—®é¢˜</a></li>
        </ul>
      </div>
          </nav>
        </div>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="content">
        <article class="doc-article">
          <div class="doc-header">
            <div class="breadcrumb">
              <a href="index.html">é¦–é¡µ</a>
              <span class="separator">></span>
              <span class="current">Context-API</span>
            </div>
            <h1 class="doc-title">Context-API</h1>
            <div class="doc-meta">
              <span class="category" style="background: #a8edea">
                ğŸ“¦ çŠ¶æ€ç®¡ç†
              </span>
            </div>
          </div>
          
          <div class="doc-content">
            <h1>22-Context API</h1>
<p>Context APIæ˜¯Reactæä¾›çš„ä¸€ç§è·¨ç»„ä»¶å…±äº«æ•°æ®çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥é¿å…propsé€å±‚ä¼ é€’çš„é—®é¢˜ã€‚Contextè®©ä½ å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®è€Œä¸å¿…ä¸€çº§ä¸€çº§æ‰‹åŠ¨ä¼ é€’propsã€‚</p>
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<h3>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Context</h3>
<p>Contextä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li><strong>Prop Drilling</strong> - æ•°æ®éœ€è¦è·¨è¶Šå¤šå±‚ç»„ä»¶ä¼ é€’</li>
<li><strong>å…¨å±€çŠ¶æ€</strong> - éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº«çš„æ•°æ®</li>
<li><strong>ä¸»é¢˜åˆ‡æ¢</strong> - å…¨å±€æ ·å¼ä¸»é¢˜</li>
<li><strong>ç”¨æˆ·è®¤è¯</strong> - ç”¨æˆ·ç™»å½•çŠ¶æ€</li>
<li><strong>å›½é™…åŒ–</strong> - è¯­è¨€åˆ‡æ¢</li>
</ul>
<h3>åŸºç¡€ç”¨æ³•</h3>
<pre><code class="language-jsx">import React, { createContext, useContext, useState } from &#39;react&#39;;

// 1. åˆ›å»ºContext
const ThemeContext = createContext();

// 2. æä¾›Context
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState(&#39;light&#39;);

  return (
    &lt;ThemeContext.Provider value={{ theme, setTheme }}&gt;
      {children}
    &lt;/ThemeContext.Provider&gt;
  );
}

// 3. ä½¿ç”¨Context
function ThemedButton() {
  const { theme, setTheme } = useContext(ThemeContext);

  return (
    &lt;button 
      style={{
        background: theme === &#39;light&#39; ? &#39;#fff&#39; : &#39;#333&#39;,
        color: theme === &#39;light&#39; ? &#39;#333&#39; : &#39;#fff&#39;
      }}
      onClick={() =&gt; setTheme(theme === &#39;light&#39; ? &#39;dark&#39; : &#39;light&#39;)}
    &gt;
      å½“å‰ä¸»é¢˜: {theme}
    &lt;/button&gt;
  );
}

// 4. åº”ç”¨ç»„ä»¶
function App() {
  return (
    &lt;ThemeProvider&gt;
      &lt;div&gt;
        &lt;h1&gt;ä¸»é¢˜åˆ‡æ¢ç¤ºä¾‹&lt;/h1&gt;
        &lt;ThemedButton /&gt;
      &lt;/div&gt;
    &lt;/ThemeProvider&gt;
  );
}
</code></pre>
<h2>åˆ›å»ºè‡ªå®šä¹‰Hook</h2>
<h3>ç®€åŒ–Contextä½¿ç”¨</h3>
<pre><code class="language-jsx">// åˆ›å»ºContextå’Œè‡ªå®šä¹‰Hook
const ThemeContext = createContext();

function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error(&#39;useTheme must be used within a ThemeProvider&#39;);
  }
  return context;
}

function ThemeProvider({ children }) {
  const [theme, setTheme] = useState(&#39;light&#39;);

  const toggleTheme = () =&gt; {
    setTheme(prev =&gt; prev === &#39;light&#39; ? &#39;dark&#39; : &#39;light&#39;);
  };

  const value = {
    theme,
    setTheme,
    toggleTheme,
    isLight: theme === &#39;light&#39;,
    isDark: theme === &#39;dark&#39;
  };

  return (
    &lt;ThemeContext.Provider value={value}&gt;
      {children}
    &lt;/ThemeContext.Provider&gt;
  );
}

// ä½¿ç”¨æ—¶æ›´ç®€æ´
function Header() {
  const { theme, toggleTheme } = useTheme();

  return (
    &lt;header style={{ background: theme === &#39;light&#39; ? &#39;#f8f9fa&#39; : &#39;#343a40&#39; }}&gt;
      &lt;h1&gt;æˆ‘çš„åº”ç”¨&lt;/h1&gt;
      &lt;button onClick={toggleTheme}&gt;
        åˆ‡æ¢åˆ° {theme === &#39;light&#39; ? &#39;æ·±è‰²&#39; : &#39;æµ…è‰²&#39;} ä¸»é¢˜
      &lt;/button&gt;
    &lt;/header&gt;
  );
}
</code></pre>
<h2>ç”¨æˆ·è®¤è¯Context</h2>
<h3>å®Œæ•´çš„è®¤è¯ç³»ç»Ÿ</h3>
<pre><code class="language-jsx">const AuthContext = createContext();

function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error(&#39;useAuth must be used within an AuthProvider&#39;);
  }
  return context;
}

function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // åˆå§‹åŒ–æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
  useEffect(() =&gt; {
    checkAuthStatus();
  }, []);

  const checkAuthStatus = async () =&gt; {
    try {
      const token = localStorage.getItem(&#39;token&#39;);
      if (token) {
        const response = await fetch(&#39;/api/auth/me&#39;, {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (response.ok) {
          const userData = await response.json();
          setUser(userData);
        } else {
          localStorage.removeItem(&#39;token&#39;);
        }
      }
    } catch (err) {
      console.error(&#39;Auth check failed:&#39;, err);
      localStorage.removeItem(&#39;token&#39;);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email, password) =&gt; {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch(&#39;/api/auth/login&#39;, {
        method: &#39;POST&#39;,
        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },
        body: JSON.stringify({ email, password })
      });

      if (!response.ok) {
        throw new Error(&#39;ç™»å½•å¤±è´¥&#39;);
      }

      const data = await response.json();
      localStorage.setItem(&#39;token&#39;, data.token);
      setUser(data.user);
      
      return { success: true };
    } catch (err) {
      setError(err.message);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  };

  const logout = () =&gt; {
    localStorage.removeItem(&#39;token&#39;);
    setUser(null);
    setError(null);
  };

  const register = async (userData) =&gt; {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch(&#39;/api/auth/register&#39;, {
        method: &#39;POST&#39;,
        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },
        body: JSON.stringify(userData)
      });

      if (!response.ok) {
        throw new Error(&#39;æ³¨å†Œå¤±è´¥&#39;);
      }

      const data = await response.json();
      localStorage.setItem(&#39;token&#39;, data.token);
      setUser(data.user);
      
      return { success: true };
    } catch (err) {
      setError(err.message);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  };

  const value = {
    user,
    loading,
    error,
    login,
    logout,
    register,
    isAuthenticated: !!user
  };

  return (
    &lt;AuthContext.Provider value={value}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
}

// ä½¿ç”¨ç¤ºä¾‹
function LoginForm() {
  const { login, loading, error } = useAuth();
  const [email, setEmail] = useState(&#39;&#39;);
  const [password, setPassword] = useState(&#39;&#39;);

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    const result = await login(email, password);
    
    if (result.success) {
      console.log(&#39;ç™»å½•æˆåŠŸ&#39;);
    }
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;input
        type=&quot;email&quot;
        value={email}
        onChange={(e) =&gt; setEmail(e.target.value)}
        placeholder=&quot;é‚®ç®±&quot;
        required
      /&gt;
      &lt;input
        type=&quot;password&quot;
        value={password}
        onChange={(e) =&gt; setPassword(e.target.value)}
        placeholder=&quot;å¯†ç &quot;
        required
      /&gt;
      &lt;button type=&quot;submit&quot; disabled={loading}&gt;
        {loading ? &#39;ç™»å½•ä¸­...&#39; : &#39;ç™»å½•&#39;}
      &lt;/button&gt;
      {error &amp;&amp; &lt;p style={{ color: &#39;red&#39; }}&gt;{error}&lt;/p&gt;}
    &lt;/form&gt;
  );
}

function UserProfile() {
  const { user, logout } = useAuth();

  return (
    &lt;div&gt;
      &lt;h2&gt;æ¬¢è¿, {user.name}!&lt;/h2&gt;
      &lt;p&gt;é‚®ç®±: {user.email}&lt;/p&gt;
      &lt;button onClick={logout}&gt;é€€å‡ºç™»å½•&lt;/button&gt;
    &lt;/div&gt;
  );
}

function App() {
  const { user, loading } = useAuth();

  if (loading) {
    return &lt;div&gt;åŠ è½½ä¸­...&lt;/div&gt;;
  }

  return (
    &lt;div&gt;
      {user ? &lt;UserProfile /&gt; : &lt;LoginForm /&gt;}
    &lt;/div&gt;
  );
}
</code></pre>
<h2>è´­ç‰©è½¦Context</h2>
<h3>ç”µå•†è´­ç‰©è½¦ç®¡ç†</h3>
<pre><code class="language-jsx">const CartContext = createContext();

function useCart() {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error(&#39;useCart must be used within a CartProvider&#39;);
  }
  return context;
}

function CartProvider({ children }) {
  const [items, setItems] = useState([]);
  const [isOpen, setIsOpen] = useState(false);

  // è®¡ç®—æ€»æ•°é‡
  const totalItems = items.reduce((sum, item) =&gt; sum + item.quantity, 0);

  // è®¡ç®—æ€»ä»·æ ¼
  const totalPrice = items.reduce((sum, item) =&gt; sum + (item.price * item.quantity), 0);

  // æ·»åŠ å•†å“
  const addItem = (product) =&gt; {
    setItems(prev =&gt; {
      const existingItem = prev.find(item =&gt; item.id === product.id);
      
      if (existingItem) {
        return prev.map(item =&gt;
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      } else {
        return [...prev, { ...product, quantity: 1 }];
      }
    });
  };

  // ç§»é™¤å•†å“
  const removeItem = (productId) =&gt; {
    setItems(prev =&gt; prev.filter(item =&gt; item.id !== productId));
  };

  // æ›´æ–°æ•°é‡
  const updateQuantity = (productId, quantity) =&gt; {
    if (quantity &lt;= 0) {
      removeItem(productId);
      return;
    }

    setItems(prev =&gt; 
      prev.map(item =&gt;
        item.id === productId
          ? { ...item, quantity }
          : item
      )
    );
  };

  // æ¸…ç©ºè´­ç‰©è½¦
  const clearCart = () =&gt; {
    setItems([]);
  };

  // è·å–ç‰¹å®šå•†å“ä¿¡æ¯
  const getItemQuantity = (productId) =&gt; {
    const item = items.find(item =&gt; item.id === productId);
    return item ? item.quantity : 0;
  };

  const value = {
    items,
    totalItems,
    totalPrice,
    isOpen,
    setIsOpen,
    addItem,
    removeItem,
    updateQuantity,
    clearCart,
    getItemQuantity
  };

  return (
    &lt;CartContext.Provider value={value}&gt;
      {children}
    &lt;/CartContext.Provider&gt;
  );
}

// äº§å“å¡ç‰‡ç»„ä»¶
function ProductCard({ product }) {
  const { addItem, getItemQuantity, updateQuantity } = useCart();
  const quantity = getItemQuantity(product.id);

  return (
    &lt;div className=&quot;product-card&quot;&gt;
      &lt;img src={product.image} alt={product.name} /&gt;
      &lt;h3&gt;{product.name}&lt;/h3&gt;
      &lt;p&gt;Â¥{product.price}&lt;/p&gt;
      
      {quantity === 0 ? (
        &lt;button onClick={() =&gt; addItem(product)}&gt;
          æ·»åŠ åˆ°è´­ç‰©è½¦
        &lt;/button&gt;
      ) : (
        &lt;div className=&quot;quantity-controls&quot;&gt;
          &lt;button onClick={() =&gt; updateQuantity(product.id, quantity - 1)}&gt;
            -
          &lt;/button&gt;
          &lt;span&gt;{quantity}&lt;/span&gt;
          &lt;button onClick={() =&gt; updateQuantity(product.id, quantity + 1)}&gt;
            +
          &lt;/button&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}

// è´­ç‰©è½¦å›¾æ ‡
function CartIcon() {
  const { totalItems, setIsOpen } = useCart();

  return (
    &lt;button 
      className=&quot;cart-icon&quot;
      onClick={() =&gt; setIsOpen(true)}
    &gt;
      ğŸ›’ {totalItems &gt; 0 &amp;&amp; &lt;span className=&quot;badge&quot;&gt;{totalItems}&lt;/span&gt;}
    &lt;/button&gt;
  );
}

// è´­ç‰©è½¦ä¾§è¾¹æ 
function CartSidebar() {
  const { items, isOpen, setIsOpen, totalPrice, updateQuantity, removeItem, clearCart } = useCart();

  if (!isOpen) return null;

  return (
    &lt;div className=&quot;cart-sidebar&quot;&gt;
      &lt;div className=&quot;cart-header&quot;&gt;
        &lt;h2&gt;è´­ç‰©è½¦&lt;/h2&gt;
        &lt;button onClick={() =&gt; setIsOpen(false)}&gt;Ã—&lt;/button&gt;
      &lt;/div&gt;
      
      &lt;div className=&quot;cart-items&quot;&gt;
        {items.length === 0 ? (
          &lt;p&gt;è´­ç‰©è½¦ä¸ºç©º&lt;/p&gt;
        ) : (
          items.map(item =&gt; (
            &lt;div key={item.id} className=&quot;cart-item&quot;&gt;
              &lt;img src={item.image} alt={item.name} /&gt;
              &lt;div&gt;
                &lt;h4&gt;{item.name}&lt;/h4&gt;
                &lt;p&gt;Â¥{item.price}&lt;/p&gt;
                &lt;div className=&quot;quantity-controls&quot;&gt;
                  &lt;button onClick={() =&gt; updateQuantity(item.id, item.quantity - 1)}&gt;
                    -
                  &lt;/button&gt;
                  &lt;span&gt;{item.quantity}&lt;/span&gt;
                  &lt;button onClick={() =&gt; updateQuantity(item.id, item.quantity + 1)}&gt;
                    +
                  &lt;/button&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;button onClick={() =&gt; removeItem(item.id)}&gt;
                åˆ é™¤
              &lt;/button&gt;
            &lt;/div&gt;
          ))
        )}
      &lt;/div&gt;
      
      {items.length &gt; 0 &amp;&amp; (
        &lt;div className=&quot;cart-footer&quot;&gt;
          &lt;div className=&quot;total&quot;&gt;
            æ€»è®¡: Â¥{totalPrice.toFixed(2)}
          &lt;/div&gt;
          &lt;button onClick={clearCart}&gt;æ¸…ç©ºè´­ç‰©è½¦&lt;/button&gt;
          &lt;button className=&quot;checkout-btn&quot;&gt;ç»“ç®—&lt;/button&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}
</code></pre>
<h2>å›½é™…åŒ–Context</h2>
<h3>å¤šè¯­è¨€æ”¯æŒ</h3>
<pre><code class="language-jsx">const I18nContext = createContext();

function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error(&#39;useI18n must be used within an I18nProvider&#39;);
  }
  return context;
}

const translations = {
  zh: {
    welcome: &#39;æ¬¢è¿&#39;,
    hello: &#39;ä½ å¥½&#39;,
    goodbye: &#39;å†è§&#39;,
    login: &#39;ç™»å½•&#39;,
    logout: &#39;é€€å‡º&#39;,
    profile: &#39;ä¸ªäººèµ„æ–™&#39;,
    settings: &#39;è®¾ç½®&#39;,
    language: &#39;è¯­è¨€&#39;,
    theme: &#39;ä¸»é¢˜&#39;,
    &#39;hello.world&#39;: &#39;ä½ å¥½ï¼Œä¸–ç•Œï¼&#39;,
    &#39;user.name&#39;: &#39;ç”¨æˆ·å&#39;,
    &#39;user.email&#39;: &#39;é‚®ç®±åœ°å€&#39;
  },
  en: {
    welcome: &#39;Welcome&#39;,
    hello: &#39;Hello&#39;,
    goodbye: &#39;Goodbye&#39;,
    login: &#39;Login&#39;,
    logout: &#39;Logout&#39;,
    profile: &#39;Profile&#39;,
    settings: &#39;Settings&#39;,
    language: &#39;Language&#39;,
    theme: &#39;Theme&#39;,
    &#39;hello.world&#39;: &#39;Hello, World!&#39;,
    &#39;user.name&#39;: &#39;Username&#39;,
    &#39;user.email&#39;: &#39;Email Address&#39;
  },
  ja: {
    welcome: &#39;ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›&#39;,
    hello: &#39;ã“ã‚“ã«ã¡ã¯&#39;,
    goodbye: &#39;ã•ã‚ˆã†ãªã‚‰&#39;,
    login: &#39;ãƒ­ã‚°ã‚¤ãƒ³&#39;,
    logout: &#39;ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ&#39;,
    profile: &#39;ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«&#39;,
    settings: &#39;è¨­å®š&#39;,
    language: &#39;è¨€èª&#39;,
    theme: &#39;ãƒ†ãƒ¼ãƒ&#39;,
    &#39;hello.world&#39;: &#39;ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼&#39;,
    &#39;user.name&#39;: &#39;ãƒ¦ãƒ¼ã‚¶ãƒ¼å&#39;,
    &#39;user.email&#39;: &#39;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹&#39;
  }
};

function I18nProvider({ children }) {
  const [locale, setLocale] = useState(&#39;zh&#39;);

  // ä»localStorageè¯»å–ä¿å­˜çš„è¯­è¨€è®¾ç½®
  useEffect(() =&gt; {
    const savedLocale = localStorage.getItem(&#39;locale&#39;);
    if (savedLocale &amp;&amp; translations[savedLocale]) {
      setLocale(savedLocale);
    }
  }, []);

  // ä¿å­˜è¯­è¨€è®¾ç½®åˆ°localStorage
  useEffect(() =&gt; {
    localStorage.setItem(&#39;locale&#39;, locale);
  }, [locale]);

  // ç¿»è¯‘å‡½æ•°
  const t = (key, params = {}) =&gt; {
    let translation = translations[locale]?.[key] || key;
    
    // æ”¯æŒå‚æ•°æ›¿æ¢
    Object.keys(params).forEach(param =&gt; {
      translation = translation.replace(`{{${param}}}`, params[param]);
    });
    
    return translation;
  };

  // æ ¼å¼åŒ–æ•°å­—
  const formatNumber = (number) =&gt; {
    return new Intl.NumberFormat(locale === &#39;zh&#39; ? &#39;zh-CN&#39; : locale).format(number);
  };

  // æ ¼å¼åŒ–æ—¥æœŸ
  const formatDate = (date, options = {}) =&gt; {
    const localeMap = {
      zh: &#39;zh-CN&#39;,
      en: &#39;en-US&#39;,
      ja: &#39;ja-JP&#39;
    };
    
    return new Intl.DateTimeFormat(localeMap[locale], options).format(date);
  };

  const value = {
    locale,
    setLocale,
    t,
    formatNumber,
    formatDate,
    availableLocales: Object.keys(translations)
  };

  return (
    &lt;I18nContext.Provider value={value}&gt;
      {children}
    &lt;/I18nContext.Provider&gt;
  );
}

// è¯­è¨€åˆ‡æ¢å™¨ç»„ä»¶
function LanguageSwitcher() {
  const { locale, setLocale, availableLocales, t } = useI18n();

  const languageNames = {
    zh: &#39;ä¸­æ–‡&#39;,
    en: &#39;English&#39;,
    ja: &#39;æ—¥æœ¬èª&#39;
  };

  return (
    &lt;div className=&quot;language-switcher&quot;&gt;
      &lt;label&gt;{t(&#39;language&#39;)}:&lt;/label&gt;
      &lt;select 
        value={locale} 
        onChange={(e) =&gt; setLocale(e.target.value)}
      &gt;
        {availableLocales.map(lang =&gt; (
          &lt;option key={lang} value={lang}&gt;
            {languageNames[lang]}
          &lt;/option&gt;
        ))}
      &lt;/select&gt;
    &lt;/div&gt;
  );
}

// å¤šè¯­è¨€ç»„ä»¶ç¤ºä¾‹
function Welcome({ userName }) {
  const { t, formatDate } = useI18n();

  return (
    &lt;div&gt;
      &lt;h1&gt;{t(&#39;hello.world&#39;)}&lt;/h1&gt;
      &lt;p&gt;{t(&#39;welcome&#39;)}, {userName}!&lt;/p&gt;
      &lt;p&gt;{formatDate(new Date(), { 
        year: &#39;numeric&#39;, 
        month: &#39;long&#39;, 
        day: &#39;numeric&#39; 
      })}&lt;/p&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>å¤åˆContextæ¨¡å¼</h2>
<h3>ç»„åˆå¤šä¸ªContext</h3>
<pre><code class="language-jsx">// ç»„åˆå¤šä¸ªProviderçš„HOC
function combineProviders(...providers) {
  return ({ children }) =&gt;
    providers.reduce(
      (AccumulatedProviders, CurrentProvider) =&gt; (
        &lt;CurrentProvider&gt;
          &lt;AccumulatedProviders /&gt;
        &lt;/CurrentProvider&gt;
      ),
      () =&gt; children
    )();
}

// æˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼
function AppProviders({ children }) {
  return (
    &lt;AuthProvider&gt;
      &lt;ThemeProvider&gt;
        &lt;I18nProvider&gt;
          &lt;CartProvider&gt;
            {children}
          &lt;/CartProvider&gt;
        &lt;/I18nProvider&gt;
      &lt;/ThemeProvider&gt;
    &lt;/AuthProvider&gt;
  );
}

// å…¨å±€çŠ¶æ€Context
const AppStateContext = createContext();

function useAppState() {
  const context = useContext(AppStateContext);
  if (!context) {
    throw new Error(&#39;useAppState must be used within an AppStateProvider&#39;);
  }
  return context;
}

function AppStateProvider({ children }) {
  const auth = useAuth();
  const theme = useTheme();
  const i18n = useI18n();
  const cart = useCart();

  // ç»„åˆæ‰€æœ‰çŠ¶æ€
  const appState = {
    auth,
    theme,
    i18n,
    cart,
    // æ·»åŠ ä¸€äº›å…¨å±€æ–¹æ³•
    reset: () =&gt; {
      auth.logout();
      cart.clearCart();
      theme.setTheme(&#39;light&#39;);
      i18n.setLocale(&#39;zh&#39;);
    }
  };

  return (
    &lt;AppStateContext.Provider value={appState}&gt;
      {children}
    &lt;/AppStateContext.Provider&gt;
  );
}
</code></pre>
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“</h3>
<pre><code class="language-jsx">// é—®é¢˜ï¼šæ•´ä¸ªContextå€¼ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»»ä½•å˜åŒ–éƒ½ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ¸²æŸ“
function BadProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState(&#39;light&#39;);

  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
  const value = {
    user,
    setUser,
    theme,
    setTheme
  };

  return (
    &lt;MyContext.Provider value={value}&gt;
      {children}
    &lt;/MyContext.Provider&gt;
  );
}

// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨useMemoç¼“å­˜value
function OptimizedProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState(&#39;light&#39;);

  // âœ… åªæœ‰ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰åˆ›å»ºæ–°å¯¹è±¡
  const value = useMemo(() =&gt; ({
    user,
    setUser,
    theme,
    setTheme
  }), [user, theme]);

  return (
    &lt;MyContext.Provider value={value}&gt;
      {children}
    &lt;/MyContext.Provider&gt;
  );
}

// è§£å†³æ–¹æ¡ˆ2ï¼šåˆ†ç¦»ä¸åŒçš„Context
const UserContext = createContext();
const ThemeContext = createContext();

function SeparatedProviders({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState(&#39;light&#39;);

  const userValue = useMemo(() =&gt; ({
    user,
    setUser
  }), [user]);

  const themeValue = useMemo(() =&gt; ({
    theme,
    setTheme
  }), [theme]);

  return (
    &lt;UserContext.Provider value={userValue}&gt;
      &lt;ThemeContext.Provider value={themeValue}&gt;
        {children}
      &lt;/ThemeContext.Provider&gt;
    &lt;/UserContext.Provider&gt;
  );
}

// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°
function CallbackOptimizedProvider({ children }) {
  const [user, setUser] = useState(null);

  const updateUser = useCallback((userData) =&gt; {
    setUser(prev =&gt; ({ ...prev, ...userData }));
  }, []);

  const logout = useCallback(() =&gt; {
    setUser(null);
  }, []);

  const value = useMemo(() =&gt; ({
    user,
    updateUser,
    logout
  }), [user, updateUser, logout]);

  return (
    &lt;MyContext.Provider value={value}&gt;
      {children}
    &lt;/MyContext.Provider&gt;
  );
}
</code></pre>
<h3>Contexté€‰æ‹©å™¨æ¨¡å¼</h3>
<pre><code class="language-jsx">// åˆ›å»ºå¸¦é€‰æ‹©å™¨çš„Context Hook
function createSelectorContext(initialState) {
  const Context = createContext();

  function Provider({ children, value }) {
    return (
      &lt;Context.Provider value={value}&gt;
        {children}
      &lt;/Context.Provider&gt;
    );
  }

  function useSelector(selector = (state) =&gt; state) {
    const context = useContext(Context);
    if (!context) {
      throw new Error(&#39;useSelector must be used within Provider&#39;);
    }

    return useMemo(() =&gt; selector(context), [context, selector]);
  }

  return { Provider, useSelector };
}

// ä½¿ç”¨ç¤ºä¾‹
const { Provider: StateProvider, useSelector } = createSelectorContext();

function MyProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState(&#39;light&#39;);
  const [cart, setCart] = useState([]);

  const value = {
    user,
    setUser,
    theme,
    setTheme,
    cart,
    setCart
  };

  return (
    &lt;StateProvider value={value}&gt;
      {children}
    &lt;/StateProvider&gt;
  );
}

// åªè®¢é˜…ç”¨æˆ·ä¿¡æ¯çš„ç»„ä»¶
function UserInfo() {
  const user = useSelector(state =&gt; state.user);
  
  return &lt;div&gt;{user?.name}&lt;/div&gt;;
}

// åªè®¢é˜…ä¸»é¢˜çš„ç»„ä»¶
function ThemeToggle() {
  const { theme, setTheme } = useSelector(state =&gt; ({
    theme: state.theme,
    setTheme: state.setTheme
  }));

  return (
    &lt;button onClick={() =&gt; setTheme(theme === &#39;light&#39; ? &#39;dark&#39; : &#39;light&#39;)}&gt;
      åˆ‡æ¢ä¸»é¢˜
    &lt;/button&gt;
  );
}
</code></pre>
<h2>æµ‹è¯•Context</h2>
<h3>Contextç»„ä»¶æµ‹è¯•</h3>
<pre><code class="language-jsx">import { render, screen, fireEvent } from &#39;@testing-library/react&#39;;
import { ThemeProvider, useTheme } from &#39;./ThemeContext&#39;;

// æµ‹è¯•å·¥å…·ç»„ä»¶
function TestComponent() {
  const { theme, toggleTheme } = useTheme();
  return (
    &lt;div&gt;
      &lt;span data-testid=&quot;theme&quot;&gt;{theme}&lt;/span&gt;
      &lt;button data-testid=&quot;toggle&quot; onClick={toggleTheme}&gt;
        Toggle
      &lt;/button&gt;
    &lt;/div&gt;
  );
}

// æµ‹è¯•Provider
function renderWithTheme(ui, { theme = &#39;light&#39; } = {}) {
  return render(
    &lt;ThemeProvider defaultTheme={theme}&gt;
      {ui}
    &lt;/ThemeProvider&gt;
  );
}

describe(&#39;ThemeContext&#39;, () =&gt; {
  test(&#39;provides theme value&#39;, () =&gt; {
    renderWithTheme(&lt;TestComponent /&gt;);
    expect(screen.getByTestId(&#39;theme&#39;)).toHaveTextContent(&#39;light&#39;);
  });

  test(&#39;toggles theme&#39;, () =&gt; {
    renderWithTheme(&lt;TestComponent /&gt;);
    
    fireEvent.click(screen.getByTestId(&#39;toggle&#39;));
    expect(screen.getByTestId(&#39;theme&#39;)).toHaveTextContent(&#39;dark&#39;);
    
    fireEvent.click(screen.getByTestId(&#39;toggle&#39;));
    expect(screen.getByTestId(&#39;theme&#39;)).toHaveTextContent(&#39;light&#39;);
  });

  test(&#39;throws error when used outside provider&#39;, () =&gt; {
    // æ•è·é”™è¯¯è¾“å‡º
    const spy = jest.spyOn(console, &#39;error&#39;).mockImplementation(() =&gt; {});
    
    expect(() =&gt; render(&lt;TestComponent /&gt;)).toThrow();
    
    spy.mockRestore();
  });
});
</code></pre>
<h2>æœ€ä½³å®è·µ</h2>
<h3>1. Contextç»“æ„è®¾è®¡</h3>
<pre><code class="language-jsx">// âœ… å¥½çš„åšæ³•ï¼šæŒ‰åŠŸèƒ½åˆ†ç¦»Context
const AuthContext = createContext();
const ThemeContext = createContext();
const SettingsContext = createContext();

// âŒ é¿å…ï¼šæŠŠæ‰€æœ‰çŠ¶æ€æ”¾åœ¨ä¸€ä¸ªå·¨å¤§çš„Contextä¸­
const AppContext = createContext(); // åŒ…å«æ‰€æœ‰åº”ç”¨çŠ¶æ€
</code></pre>
<h3>2. é”™è¯¯å¤„ç†</h3>
<pre><code class="language-jsx">function useAuthRequired() {
  const auth = useAuth();
  
  if (!auth.isAuthenticated) {
    throw new Error(&#39;This component requires authentication&#39;);
  }
  
  return auth;
}

// é”™è¯¯è¾¹ç•Œç»„ä»¶
class ContextErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error(&#39;Context error:&#39;, error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || &lt;div&gt;Something went wrong&lt;/div&gt;;
    }

    return this.props.children;
  }
}
</code></pre>
<h3>3. è°ƒè¯•å’Œå¼€å‘å·¥å…·</h3>
<pre><code class="language-jsx">// å¼€å‘ç¯å¢ƒä¸‹çš„Contextè°ƒè¯•
function DebugProvider({ children, name }) {
  const [logs, setLogs] = useState([]);

  const Provider = useMemo(() =&gt; {
    const OriginalProvider = React.createContext().Provider;
    
    return function DebuggingProvider({ value, children }) {
      useEffect(() =&gt; {
        if (process.env.NODE_ENV === &#39;development&#39;) {
          setLogs(prev =&gt; [...prev, { 
            timestamp: Date.now(), 
            value: JSON.stringify(value) 
          }]);
        }
      }, [value]);

      return &lt;OriginalProvider value={value}&gt;{children}&lt;/OriginalProvider&gt;;
    };
  }, []);

  // åœ¨å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
  if (process.env.NODE_ENV === &#39;development&#39;) {
    console.log(`${name} Context logs:`, logs);
  }

  return &lt;Provider&gt;{children}&lt;/Provider&gt;;
}
</code></pre>
<h2>æ€»ç»“</h2>
<p>Context APIçš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol>
<li><strong>åˆç†ä½¿ç”¨</strong> - é¿å…è¿‡åº¦ä½¿ç”¨ï¼Œåªç”¨äºçœŸæ­£éœ€è¦è·¨ç»„ä»¶å…±äº«çš„æ•°æ®</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong> - ä½¿ç”¨useMemoç¼“å­˜valueï¼Œè€ƒè™‘åˆ†ç¦»ä¸åŒçš„Context</li>
<li><strong>é”™è¯¯å¤„ç†</strong> - æä¾›é”™è¯¯è¾¹ç•Œå’Œfallbackæœºåˆ¶</li>
<li><strong>ç±»å‹å®‰å…¨</strong> - åœ¨TypeScriptä¸­å®šä¹‰æ¸…æ™°çš„ç±»å‹</li>
<li><strong>æµ‹è¯•å‹å¥½</strong> - æä¾›æµ‹è¯•å·¥å…·å’Œmock Provider</li>
</ol>
<p>Context APIæ˜¯ReactçŠ¶æ€ç®¡ç†çš„åŸºç¡€ï¼ŒæŒæ¡å®ƒå¯¹äºæ„å»ºå¤æ‚åº”ç”¨è‡³å…³é‡è¦ã€‚åœ¨é€‰æ‹©çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨çš„å¤æ‚åº¦å’Œéœ€æ±‚æ¥å†³å®šæ˜¯å¦ä½¿ç”¨Context APIæˆ–å…¶ä»–çŠ¶æ€ç®¡ç†åº“ã€‚ </p>

          </div>

          <!-- æ–‡æ¡£å¯¼èˆª -->
          <div class="doc-navigation">
            
              <a href="21-React-Router.html" class="nav-btn prev-btn">
                <span class="nav-icon">â†</span>
                <div class="nav-text">
                  <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                  <span class="nav-title">React-Router</span>
                </div>
              </a>
            
            
            
              <a href="23-Reduxé›†æˆ.html" class="nav-btn next-btn">
                <div class="nav-text">
                  <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                  <span class="nav-title">Reduxé›†æˆ</span>
                </div>
                <span class="nav-icon">â†’</span>
              </a>
            
          </div>
        </article>
      </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <span>â†‘</span>
    </button>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 React ä¸­æ–‡æ–‡æ¡£. åŸºäº React 18.x æ„å»º</p>
        <p>Made with â¤ï¸ by Reactä¸­æ–‡ç¤¾åŒº</p>
      </div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>