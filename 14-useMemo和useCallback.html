<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>useMemoå’ŒuseCallback - React ä¸­æ–‡æ–‡æ¡£</title>
  <meta name="description" content="ä»å…¥é—¨åˆ°ç²¾é€šï¼Œå…¨é¢æŒæ¡Reactå¼€å‘æŠ€èƒ½">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="assets/highlight.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">âš›ï¸</span>
          <div class="logo-text">
            <h1>React ä¸­æ–‡æ–‡æ¡£</h1>
            <p>ç°ä»£åŒ–çš„Reactå­¦ä¹ æŒ‡å—</p>
          </div>
        </div>
        <nav class="header-nav">
          <a href="index.html" class="nav-link">é¦–é¡µ</a>
          <a href="#" class="nav-link" onclick="toggleSidebar()">ç›®å½•</a>
          <a href="https://github.com/facebook/react" target="_blank" class="nav-link">GitHub</a>
        </nav>
      </div>
    </header>

    <div class="main-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <div class="search-box">
            <input type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput" onkeyup="searchDocs()">
            <span class="search-icon">ğŸ”</span>
          </div>
          <nav class="doc-nav">
            
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“š</span>
          åŸºç¡€æ¦‚å¿µ
        </h3>
        <ul class="category-docs">
          <li><a href="01-Reactç®€ä»‹.html" class="doc-link">Reactç®€ä»‹</a></li><li><a href="02-ç¯å¢ƒæ­å»º.html" class="doc-link">ç¯å¢ƒæ­å»º</a></li><li><a href="03-JSXè¯­æ³•.html" class="doc-link">JSXè¯­æ³•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§©</span>
          ç»„ä»¶å¼€å‘
        </h3>
        <ul class="category-docs">
          <li><a href="04-ç»„ä»¶åŸºç¡€.html" class="doc-link">ç»„ä»¶åŸºç¡€</a></li><li><a href="05-Propsä¸State.html" class="doc-link">Propsä¸State</a></li><li><a href="06-äº‹ä»¶å¤„ç†.html" class="doc-link">äº‹ä»¶å¤„ç†</a></li><li><a href="07-æ¡ä»¶æ¸²æŸ“.html" class="doc-link">æ¡ä»¶æ¸²æŸ“</a></li><li><a href="08-åˆ—è¡¨æ¸²æŸ“.html" class="doc-link">åˆ—è¡¨æ¸²æŸ“</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ£</span>
          Hooks API
        </h3>
        <ul class="category-docs">
          <li><a href="09-Hooksæ¦‚è¿°.html" class="doc-link">Hooksæ¦‚è¿°</a></li><li><a href="10-useState.html" class="doc-link">useState</a></li><li><a href="11-useEffect.html" class="doc-link">useEffect</a></li><li><a href="12-useContext.html" class="doc-link">useContext</a></li><li><a href="13-useReducer.html" class="doc-link">useReducer</a></li><li><a href="14-useMemoå’ŒuseCallback.html" class="doc-link">useMemoå’ŒuseCallback</a></li><li><a href="15-useRef.html" class="doc-link">useRef</a></li><li><a href="16-è‡ªå®šä¹‰Hooks.html" class="doc-link">è‡ªå®šä¹‰Hooks</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ”„</span>
          ç”Ÿå‘½å‘¨æœŸ
        </h3>
        <ul class="category-docs">
          <li><a href="17-ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.html" class="doc-link">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li><li><a href="18-å‰¯ä½œç”¨å¤„ç†.html" class="doc-link">å‰¯ä½œç”¨å¤„ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ¨</span>
          æ ·å¼ä¸UI
        </h3>
        <ul class="category-docs">
          <li><a href="19-æ ·å¼å¤„ç†.html" class="doc-link">æ ·å¼å¤„ç†</a></li><li><a href="20-åŠ¨ç”»æ•ˆæœ.html" class="doc-link">åŠ¨ç”»æ•ˆæœ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ºï¸</span>
          è·¯ç”±ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="21-React-Router.html" class="doc-link">React-Router</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“¦</span>
          çŠ¶æ€ç®¡ç†
        </h3>
        <ul class="category-docs">
          <li><a href="22-Context-API.html" class="doc-link">Context-API</a></li><li><a href="23-Reduxé›†æˆ.html" class="doc-link">Reduxé›†æˆ</a></li><li><a href="24-ZustandçŠ¶æ€ç®¡ç†.html" class="doc-link">ZustandçŠ¶æ€ç®¡ç†</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸš€</span>
          æ€§èƒ½ä¼˜åŒ–
        </h3>
        <ul class="category-docs">
          <li><a href="25-æ€§èƒ½ä¼˜åŒ–æŠ€å·§.html" class="doc-link">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href="26-ä»£ç åˆ†å‰².html" class="doc-link">ä»£ç åˆ†å‰²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ§ª</span>
          æµ‹è¯•
        </h3>
        <ul class="category-docs">
          <li><a href="27-å•å…ƒæµ‹è¯•.html" class="doc-link">å•å…ƒæµ‹è¯•</a></li><li><a href="28-é›†æˆæµ‹è¯•.html" class="doc-link">é›†æˆæµ‹è¯•</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ—ï¸</span>
          æ„å»ºä¸éƒ¨ç½²
        </h3>
        <ul class="category-docs">
          <li><a href="29-é¡¹ç›®æ„å»º.html" class="doc-link">é¡¹ç›®æ„å»º</a></li><li><a href="30-ç”Ÿäº§éƒ¨ç½².html" class="doc-link">ç”Ÿäº§éƒ¨ç½²</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ› ï¸</span>
          å¼€å‘å·¥å…·
        </h3>
        <ul class="category-docs">
          <li><a href="31-å¼€å‘è€…å·¥å…·.html" class="doc-link">å¼€å‘è€…å·¥å…·</a></li><li><a href="32-è°ƒè¯•æŠ€å·§.html" class="doc-link">è°ƒè¯•æŠ€å·§</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ“–</span>
          APIå‚è€ƒ
        </h3>
        <ul class="category-docs">
          <li><a href="33-React-APIå®Œæ•´å‚è€ƒ.html" class="doc-link">React-APIå®Œæ•´å‚è€ƒ</a></li><li><a href="34-DOMå…ƒç´ å±æ€§.html" class="doc-link">DOMå…ƒç´ å±æ€§</a></li><li><a href="35-åˆæˆäº‹ä»¶.html" class="doc-link">åˆæˆäº‹ä»¶</a></li><li><a href="React-Hookså®Œæ•´å‚è€ƒ.html" class="doc-link">React-Hookså®Œæ•´å‚è€ƒ</a></li>
        </ul>
      </div>
      <div class="nav-category">
        <h3 class="category-title">
          <span class="category-icon">ğŸ’¡</span>
          æœ€ä½³å®è·µ
        </h3>
        <ul class="category-docs">
          <li><a href="36-ç¼–ç è§„èŒƒ.html" class="doc-link">ç¼–ç è§„èŒƒ</a></li><li><a href="37-é¡¹ç›®æ¶æ„.html" class="doc-link">é¡¹ç›®æ¶æ„</a></li><li><a href="38-å¸¸è§é—®é¢˜.html" class="doc-link">å¸¸è§é—®é¢˜</a></li>
        </ul>
      </div>
          </nav>
        </div>
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="content">
        <article class="doc-article">
          <div class="doc-header">
            <div class="breadcrumb">
              <a href="index.html">é¦–é¡µ</a>
              <span class="separator">></span>
              <span class="current">useMemoå’ŒuseCallback</span>
            </div>
            <h1 class="doc-title">useMemoå’ŒuseCallback</h1>
            <div class="doc-meta">
              <span class="category" style="background: #4facfe">
                ğŸ£ Hooks API
              </span>
            </div>
          </div>
          
          <div class="doc-content">
            <h1>14-useMemoå’ŒuseCallback</h1>
<p><code>useMemo</code> å’Œ <code>useCallback</code> æ˜¯Reactä¸­ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„é‡è¦Hooksã€‚å®ƒä»¬é€šè¿‡ç¼“å­˜è®¡ç®—ç»“æœå’Œå‡½æ•°æ¥é¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—å’Œé‡æ–°æ¸²æŸ“ã€‚</p>
<h2>useMemo</h2>
<h3>åŸºç¡€æ¦‚å¿µ</h3>
<p><code>useMemo</code> è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å€¼ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ã€‚</p>
<pre><code class="language-jsx">import React, { useMemo, useState } from &#39;react&#39;;

function ExpensiveComponent({ items, multiplier }) {
  // æ˜‚è´µçš„è®¡ç®—
  const expensiveValue = useMemo(() =&gt; {
    console.log(&#39;æ­£åœ¨è¿›è¡Œæ˜‚è´µçš„è®¡ç®—...&#39;);
    return items.reduce((sum, item) =&gt; sum + item * multiplier, 0);
  }, [items, multiplier]); // ä¾èµ–é¡¹æ•°ç»„

  return (
    &lt;div&gt;
      &lt;h3&gt;è®¡ç®—ç»“æœ: {expensiveValue}&lt;/h3&gt;
    &lt;/div&gt;
  );
}

function App() {
  const [items, setItems] = useState([1, 2, 3, 4, 5]);
  const [multiplier, setMultiplier] = useState(1);
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;ExpensiveComponent items={items} multiplier={multiplier} /&gt;
      
      {/* è¿™ä¸ªæŒ‰é’®ç‚¹å‡»ä¸ä¼šè§¦å‘æ˜‚è´µè®¡ç®—çš„é‡æ–°æ‰§è¡Œ */}
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Count: {count}
      &lt;/button&gt;
      
      {/* è¿™äº›æŒ‰é’®ä¼šè§¦å‘é‡æ–°è®¡ç®— */}
      &lt;button onClick={() =&gt; setMultiplier(multiplier + 1)}&gt;
        å¢åŠ å€æ•°: {multiplier}
      &lt;/button&gt;
      
      &lt;button onClick={() =&gt; setItems([...items, items.length + 1])}&gt;
        æ·»åŠ é¡¹ç›®
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h3>å¤æ‚è®¡ç®—ç¼“å­˜</h3>
<pre><code class="language-jsx">function DataAnalytics({ data, filters, sortBy }) {
  // è¿‡æ»¤æ•°æ®
  const filteredData = useMemo(() =&gt; {
    console.log(&#39;è¿‡æ»¤æ•°æ®...&#39;);
    return data.filter(item =&gt; {
      return Object.keys(filters).every(key =&gt; {
        if (!filters[key]) return true;
        return String(item[key]).toLowerCase().includes(
          String(filters[key]).toLowerCase()
        );
      });
    });
  }, [data, filters]);

  // æ’åºæ•°æ®
  const sortedData = useMemo(() =&gt; {
    console.log(&#39;æ’åºæ•°æ®...&#39;);
    if (!sortBy) return filteredData;
    
    return [...filteredData].sort((a, b) =&gt; {
      const aValue = a[sortBy];
      const bValue = b[sortBy];
      
      if (typeof aValue === &#39;string&#39;) {
        return aValue.localeCompare(bValue);
      }
      return aValue - bValue;
    });
  }, [filteredData, sortBy]);

  // ç»Ÿè®¡ä¿¡æ¯
  const statistics = useMemo(() =&gt; {
    console.log(&#39;è®¡ç®—ç»Ÿè®¡ä¿¡æ¯...&#39;);
    return {
      total: sortedData.length,
      average: sortedData.reduce((sum, item) =&gt; sum + item.value, 0) / sortedData.length,
      max: Math.max(...sortedData.map(item =&gt; item.value)),
      min: Math.min(...sortedData.map(item =&gt; item.value))
    };
  }, [sortedData]);

  return (
    &lt;div&gt;
      &lt;div className=&quot;statistics&quot;&gt;
        &lt;p&gt;æ€»æ•°: {statistics.total}&lt;/p&gt;
        &lt;p&gt;å¹³å‡å€¼: {statistics.average.toFixed(2)}&lt;/p&gt;
        &lt;p&gt;æœ€å¤§å€¼: {statistics.max}&lt;/p&gt;
        &lt;p&gt;æœ€å°å€¼: {statistics.min}&lt;/p&gt;
      &lt;/div&gt;
      
      &lt;div className=&quot;data-list&quot;&gt;
        {sortedData.map(item =&gt; (
          &lt;div key={item.id} className=&quot;data-item&quot;&gt;
            &lt;span&gt;{item.name}&lt;/span&gt;
            &lt;span&gt;{item.value}&lt;/span&gt;
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h3>å¯¹è±¡å’Œæ•°ç»„çš„ç¼“å­˜</h3>
<pre><code class="language-jsx">function UserProfile({ userId }) {
  const [userData, setUserData] = useState(null);
  const [preferences, setPreferences] = useState({});

  // ç¼“å­˜ç”¨æˆ·é…ç½®å¯¹è±¡
  const userConfig = useMemo(() =&gt; ({
    theme: preferences.theme || &#39;light&#39;,
    language: preferences.language || &#39;zh&#39;,
    notifications: preferences.notifications !== false,
    layout: preferences.layout || &#39;grid&#39;
  }), [preferences]);

  // ç¼“å­˜æ ¼å¼åŒ–çš„ç”¨æˆ·æ•°æ®
  const formattedUserData = useMemo(() =&gt; {
    if (!userData) return null;
    
    return {
      ...userData,
      fullName: `${userData.firstName} ${userData.lastName}`,
      joinedDate: new Date(userData.createdAt).toLocaleDateString(),
      isActive: userData.lastLoginAt &gt; Date.now() - 30 * 24 * 60 * 60 * 1000
    };
  }, [userData]);

  // ç¼“å­˜èœå•é¡¹
  const menuItems = useMemo(() =&gt; [
    { id: &#39;profile&#39;, label: &#39;ä¸ªäººèµ„æ–™&#39;, icon: &#39;ğŸ‘¤&#39; },
    { id: &#39;settings&#39;, label: &#39;è®¾ç½®&#39;, icon: &#39;âš™ï¸&#39; },
    { id: &#39;help&#39;, label: &#39;å¸®åŠ©&#39;, icon: &#39;â“&#39; },
    ...(userConfig.notifications ? [
      { id: &#39;notifications&#39;, label: &#39;é€šçŸ¥&#39;, icon: &#39;ğŸ””&#39; }
    ] : [])
  ], [userConfig.notifications]);

  return (
    &lt;div className={`user-profile theme-${userConfig.theme}`}&gt;
      {formattedUserData &amp;&amp; (
        &lt;div className=&quot;user-info&quot;&gt;
          &lt;h2&gt;{formattedUserData.fullName}&lt;/h2&gt;
          &lt;p&gt;åŠ å…¥æ—¶é—´: {formattedUserData.joinedDate}&lt;/p&gt;
          &lt;span className={`status ${formattedUserData.isActive ? &#39;active&#39; : &#39;inactive&#39;}`}&gt;
            {formattedUserData.isActive ? &#39;æ´»è·ƒ&#39; : &#39;éæ´»è·ƒ&#39;}
          &lt;/span&gt;
        &lt;/div&gt;
      )}
      
      &lt;nav className=&quot;user-menu&quot;&gt;
        {menuItems.map(item =&gt; (
          &lt;button key={item.id} className=&quot;menu-item&quot;&gt;
            &lt;span&gt;{item.icon}&lt;/span&gt;
            &lt;span&gt;{item.label}&lt;/span&gt;
          &lt;/button&gt;
        ))}
      &lt;/nav&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>useCallback</h2>
<h3>åŸºç¡€æ¦‚å¿µ</h3>
<p><code>useCallback</code> è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šè¿”å›æ–°çš„å‡½æ•°ã€‚</p>
<pre><code class="language-jsx">function TodoList({ todos, onToggle, onDelete }) {
  const [filter, setFilter] = useState(&#39;all&#39;);

  // ç¼“å­˜è¿‡æ»¤å‡½æ•°
  const handleFilterChange = useCallback((newFilter) =&gt; {
    setFilter(newFilter);
  }, []);

  // ç¼“å­˜åˆ‡æ¢å®ŒæˆçŠ¶æ€çš„å‡½æ•°
  const handleToggle = useCallback((id) =&gt; {
    onToggle(id);
  }, [onToggle]);

  // ç¼“å­˜åˆ é™¤å‡½æ•°
  const handleDelete = useCallback((id) =&gt; {
    onDelete(id);
  }, [onDelete]);

  const filteredTodos = useMemo(() =&gt; {
    switch (filter) {
      case &#39;active&#39;:
        return todos.filter(todo =&gt; !todo.completed);
      case &#39;completed&#39;:
        return todos.filter(todo =&gt; todo.completed);
      default:
        return todos;
    }
  }, [todos, filter]);

  return (
    &lt;div&gt;
      &lt;FilterButtons 
        currentFilter={filter}
        onFilterChange={handleFilterChange}
      /&gt;
      
      &lt;ul&gt;
        {filteredTodos.map(todo =&gt; (
          &lt;TodoItem
            key={todo.id}
            todo={todo}
            onToggle={handleToggle}
            onDelete={handleDelete}
          /&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}

// ä½¿ç”¨React.memoä¼˜åŒ–çš„å­ç»„ä»¶
const TodoItem = React.memo(({ todo, onToggle, onDelete }) =&gt; {
  console.log(`TodoItem ${todo.id} é‡æ–°æ¸²æŸ“`);
  
  return (
    &lt;li className={todo.completed ? &#39;completed&#39; : &#39;&#39;}&gt;
      &lt;span&gt;{todo.text}&lt;/span&gt;
      &lt;button onClick={() =&gt; onToggle(todo.id)}&gt;
        {todo.completed ? &#39;å–æ¶ˆå®Œæˆ&#39; : &#39;å®Œæˆ&#39;}
      &lt;/button&gt;
      &lt;button onClick={() =&gt; onDelete(todo.id)}&gt;
        åˆ é™¤
      &lt;/button&gt;
    &lt;/li&gt;
  );
});

const FilterButtons = React.memo(({ currentFilter, onFilterChange }) =&gt; {
  console.log(&#39;FilterButtons é‡æ–°æ¸²æŸ“&#39;);
  
  const filters = [&#39;all&#39;, &#39;active&#39;, &#39;completed&#39;];
  const filterLabels = { all: &#39;å…¨éƒ¨&#39;, active: &#39;æœªå®Œæˆ&#39;, completed: &#39;å·²å®Œæˆ&#39; };

  return (
    &lt;div className=&quot;filter-buttons&quot;&gt;
      {filters.map(filter =&gt; (
        &lt;button
          key={filter}
          className={currentFilter === filter ? &#39;active&#39; : &#39;&#39;}
          onClick={() =&gt; onFilterChange(filter)}
        &gt;
          {filterLabels[filter]}
        &lt;/button&gt;
      ))}
    &lt;/div&gt;
  );
});
</code></pre>
<h3>äº‹ä»¶å¤„ç†å‡½æ•°ä¼˜åŒ–</h3>
<pre><code class="language-jsx">function UserForm({ initialData, onSubmit }) {
  const [formData, setFormData] = useState(initialData || {});
  const [errors, setErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ç¼“å­˜å­—æ®µæ›´æ–°å‡½æ•°
  const handleFieldChange = useCallback((fieldName, value) =&gt; {
    setFormData(prev =&gt; ({
      ...prev,
      [fieldName]: value
    }));
    
    // æ¸…é™¤è¯¥å­—æ®µçš„é”™è¯¯
    if (errors[fieldName]) {
      setErrors(prev =&gt; ({
        ...prev,
        [fieldName]: null
      }));
    }
  }, [errors]);

  // ç¼“å­˜éªŒè¯å‡½æ•°
  const validateField = useCallback((fieldName, value) =&gt; {
    const validationRules = {
      name: (val) =&gt; val?.length &gt;= 2 ? null : &#39;å§“åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦&#39;,
      email: (val) =&gt; /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val) ? null : &#39;è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€&#39;,
      age: (val) =&gt; val &gt;= 18 ? null : &#39;å¹´é¾„å¿…é¡»å¤§äºç­‰äº18å²&#39;
    };

    const rule = validationRules[fieldName];
    return rule ? rule(value) : null;
  }, []);

  // ç¼“å­˜è¡¨å•æäº¤å‡½æ•°
  const handleSubmit = useCallback(async (e) =&gt; {
    e.preventDefault();
    
    // éªŒè¯æ‰€æœ‰å­—æ®µ
    const newErrors = {};
    Object.keys(formData).forEach(fieldName =&gt; {
      const error = validateField(fieldName, formData[fieldName]);
      if (error) {
        newErrors[fieldName] = error;
      }
    });

    if (Object.keys(newErrors).length &gt; 0) {
      setErrors(newErrors);
      return;
    }

    setIsSubmitting(true);
    try {
      await onSubmit(formData);
    } catch (error) {
      setErrors({ general: &#39;æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•&#39; });
    } finally {
      setIsSubmitting(false);
    }
  }, [formData, validateField, onSubmit]);

  // ç¼“å­˜é‡ç½®å‡½æ•°
  const handleReset = useCallback(() =&gt; {
    setFormData(initialData || {});
    setErrors({});
  }, [initialData]);

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;FormField
        name=&quot;name&quot;
        label=&quot;å§“å&quot;
        value={formData.name || &#39;&#39;}
        error={errors.name}
        onChange={handleFieldChange}
        onValidate={validateField}
      /&gt;
      
      &lt;FormField
        name=&quot;email&quot;
        label=&quot;é‚®ç®±&quot;
        type=&quot;email&quot;
        value={formData.email || &#39;&#39;}
        error={errors.email}
        onChange={handleFieldChange}
        onValidate={validateField}
      /&gt;
      
      &lt;FormField
        name=&quot;age&quot;
        label=&quot;å¹´é¾„&quot;
        type=&quot;number&quot;
        value={formData.age || &#39;&#39;}
        error={errors.age}
        onChange={handleFieldChange}
        onValidate={validateField}
      /&gt;

      {errors.general &amp;&amp; (
        &lt;div className=&quot;error&quot;&gt;{errors.general}&lt;/div&gt;
      )}

      &lt;div className=&quot;form-actions&quot;&gt;
        &lt;button type=&quot;submit&quot; disabled={isSubmitting}&gt;
          {isSubmitting ? &#39;æäº¤ä¸­...&#39; : &#39;æäº¤&#39;}
        &lt;/button&gt;
        &lt;button type=&quot;button&quot; onClick={handleReset}&gt;
          é‡ç½®
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  );
}

const FormField = React.memo(({ 
  name, 
  label, 
  type = &#39;text&#39;, 
  value, 
  error, 
  onChange, 
  onValidate 
}) =&gt; {
  console.log(`FormField ${name} é‡æ–°æ¸²æŸ“`);

  const handleChange = useCallback((e) =&gt; {
    const newValue = type === &#39;number&#39; ? Number(e.target.value) : e.target.value;
    onChange(name, newValue);
  }, [name, type, onChange]);

  const handleBlur = useCallback(() =&gt; {
    const validationError = onValidate(name, value);
    if (validationError) {
      // è¿™é‡Œå¯ä»¥è®¾ç½®å­—æ®µçº§åˆ«çš„é”™è¯¯
    }
  }, [name, value, onValidate]);

  return (
    &lt;div className=&quot;form-field&quot;&gt;
      &lt;label htmlFor={name}&gt;{label}&lt;/label&gt;
      &lt;input
        id={name}
        type={type}
        value={value}
        onChange={handleChange}
        onBlur={handleBlur}
        className={error ? &#39;error&#39; : &#39;&#39;}
      /&gt;
      {error &amp;&amp; &lt;span className=&quot;error-message&quot;&gt;{error}&lt;/span&gt;}
    &lt;/div&gt;
  );
});
</code></pre>
<h2>ç»„åˆä½¿ç”¨</h2>
<h3>æ•°æ®è·å–å’Œç¼“å­˜</h3>
<pre><code class="language-jsx">function DataVisualization({ endpoint, filters, refreshInterval }) {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // ç¼“å­˜APIè°ƒç”¨å‡½æ•°
  const fetchData = useCallback(async () =&gt; {
    setLoading(true);
    setError(null);
    
    try {
      const queryParams = new URLSearchParams(filters).toString();
      const url = `${endpoint}?${queryParams}`;
      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const result = await response.json();
      setData(result);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  }, [endpoint, filters]);

  // è‡ªåŠ¨åˆ·æ–°
  useEffect(() =&gt; {
    fetchData();
    
    if (refreshInterval &gt; 0) {
      const interval = setInterval(fetchData, refreshInterval);
      return () =&gt; clearInterval(interval);
    }
  }, [fetchData, refreshInterval]);

  // ç¼“å­˜å›¾è¡¨æ•°æ®
  const chartData = useMemo(() =&gt; {
    if (!data.length) return null;
    
    return {
      labels: data.map(item =&gt; item.label),
      datasets: [{
        data: data.map(item =&gt; item.value),
        backgroundColor: data.map((_, index) =&gt; 
          `hsl(${(index * 360) / data.length}, 70%, 50%)`
        )
      }]
    };
  }, [data]);

  // ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
  const statistics = useMemo(() =&gt; {
    if (!data.length) return null;
    
    const values = data.map(item =&gt; item.value);
    return {
      total: values.reduce((sum, val) =&gt; sum + val, 0),
      average: values.reduce((sum, val) =&gt; sum + val, 0) / values.length,
      max: Math.max(...values),
      min: Math.min(...values),
      count: values.length
    };
  }, [data]);

  // ç¼“å­˜é‡æ–°è·å–å‡½æ•°
  const handleRefresh = useCallback(() =&gt; {
    fetchData();
  }, [fetchData]);

  // ç¼“å­˜å¯¼å‡ºå‡½æ•°
  const handleExport = useCallback(() =&gt; {
    const csvContent = [
      [&#39;Label&#39;, &#39;Value&#39;],
      ...data.map(item =&gt; [item.label, item.value])
    ].map(row =&gt; row.join(&#39;,&#39;)).join(&#39;\n&#39;);
    
    const blob = new Blob([csvContent], { type: &#39;text/csv&#39; });
    const url = URL.createObjectURL(blob);
    const a = document.createElement(&#39;a&#39;);
    a.href = url;
    a.download = &#39;data.csv&#39;;
    a.click();
    URL.revokeObjectURL(url);
  }, [data]);

  if (loading) return &lt;div&gt;åŠ è½½ä¸­...&lt;/div&gt;;
  if (error) return &lt;div&gt;é”™è¯¯: {error}&lt;/div&gt;;

  return (
    &lt;div className=&quot;data-visualization&quot;&gt;
      &lt;div className=&quot;controls&quot;&gt;
        &lt;button onClick={handleRefresh}&gt;åˆ·æ–°&lt;/button&gt;
        &lt;button onClick={handleExport} disabled={!data.length}&gt;
          å¯¼å‡ºCSV
        &lt;/button&gt;
      &lt;/div&gt;
      
      {statistics &amp;&amp; (
        &lt;StatisticsPanel statistics={statistics} /&gt;
      )}
      
      {chartData &amp;&amp; (
        &lt;Chart data={chartData} /&gt;
      )}
    &lt;/div&gt;
  );
}

const StatisticsPanel = React.memo(({ statistics }) =&gt; {
  console.log(&#39;StatisticsPanel é‡æ–°æ¸²æŸ“&#39;);
  
  return (
    &lt;div className=&quot;statistics-panel&quot;&gt;
      &lt;div className=&quot;stat&quot;&gt;
        &lt;label&gt;æ€»è®¡:&lt;/label&gt;
        &lt;span&gt;{statistics.total}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div className=&quot;stat&quot;&gt;
        &lt;label&gt;å¹³å‡:&lt;/label&gt;
        &lt;span&gt;{statistics.average.toFixed(2)}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div className=&quot;stat&quot;&gt;
        &lt;label&gt;æœ€å¤§:&lt;/label&gt;
        &lt;span&gt;{statistics.max}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div className=&quot;stat&quot;&gt;
        &lt;label&gt;æœ€å°:&lt;/label&gt;
        &lt;span&gt;{statistics.min}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div className=&quot;stat&quot;&gt;
        &lt;label&gt;æ•°é‡:&lt;/label&gt;
        &lt;span&gt;{statistics.count}&lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
});
</code></pre>
<h2>æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹</h2>
<pre><code class="language-jsx">// æœªä¼˜åŒ–ç‰ˆæœ¬
function UnoptimizedComponent({ items, multiplier }) {
  const [count, setCount] = useState(0);

  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®—
  const expensiveValue = items.reduce((sum, item) =&gt; {
    console.log(&#39;è®¡ç®—ä¸­...&#39;);
    return sum + item * multiplier;
  }, 0);

  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°å‡½æ•°
  const handleClick = () =&gt; {
    console.log(&#39;ç‚¹å‡»&#39;);
  };

  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡
  const itemsWithId = items.map(item =&gt; ({
    id: Math.random(),
    value: item
  }));

  return (
    &lt;div&gt;
      &lt;p&gt;æ˜‚è´µè®¡ç®—ç»“æœ: {expensiveValue}&lt;/p&gt;
      &lt;p&gt;è®¡æ•°: {count}&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;å¢åŠ è®¡æ•°&lt;/button&gt;
      &lt;ItemList items={itemsWithId} onClick={handleClick} /&gt;
    &lt;/div&gt;
  );
}

// ä¼˜åŒ–ç‰ˆæœ¬
function OptimizedComponent({ items, multiplier }) {
  const [count, setCount] = useState(0);

  // âœ… åªåœ¨ä¾èµ–é¡¹æ”¹å˜æ—¶é‡æ–°è®¡ç®—
  const expensiveValue = useMemo(() =&gt; {
    console.log(&#39;è®¡ç®—ä¸­...&#39;);
    return items.reduce((sum, item) =&gt; sum + item * multiplier, 0);
  }, [items, multiplier]);

  // âœ… ç¼“å­˜å‡½æ•°ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
  const handleClick = useCallback(() =&gt; {
    console.log(&#39;ç‚¹å‡»&#39;);
  }, []);

  // âœ… ç¼“å­˜å¯¹è±¡æ•°ç»„
  const itemsWithId = useMemo(() =&gt; 
    items.map((item, index) =&gt; ({
      id: index, // ä½¿ç”¨ç¨³å®šçš„ID
      value: item
    })),
    [items]
  );

  // âœ… ç¼“å­˜è®¡æ•°å¢åŠ å‡½æ•°
  const incrementCount = useCallback(() =&gt; {
    setCount(prev =&gt; prev + 1);
  }, []);

  return (
    &lt;div&gt;
      &lt;p&gt;æ˜‚è´µè®¡ç®—ç»“æœ: {expensiveValue}&lt;/p&gt;
      &lt;p&gt;è®¡æ•°: {count}&lt;/p&gt;
      &lt;button onClick={incrementCount}&gt;å¢åŠ è®¡æ•°&lt;/button&gt;
      &lt;ItemList items={itemsWithId} onClick={handleClick} /&gt;
    &lt;/div&gt;
  );
}

const ItemList = React.memo(({ items, onClick }) =&gt; {
  console.log(&#39;ItemList é‡æ–°æ¸²æŸ“&#39;);
  
  return (
    &lt;ul&gt;
      {items.map(item =&gt; (
        &lt;li key={item.id} onClick={onClick}&gt;
          {item.value}
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
});
</code></pre>
<h2>å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ</h2>
<h3>1. ä¾èµ–é¡¹æ•°ç»„</h3>
<pre><code class="language-jsx">function Component({ user, settings }) {
  // âŒ å¿˜è®°æ·»åŠ ä¾èµ–é¡¹
  const userInfo = useMemo(() =&gt; ({
    name: user.name,
    theme: settings.theme
  }), []); // ç¼ºå°‘ä¾èµ–é¡¹

  // âœ… æ­£ç¡®çš„ä¾èµ–é¡¹
  const userInfo = useMemo(() =&gt; ({
    name: user.name,
    theme: settings.theme
  }), [user.name, settings.theme]);

  // âŒ è¿‡åº¦ä¾èµ–
  const expensiveCalc = useMemo(() =&gt; {
    return user.scores.reduce((sum, score) =&gt; sum + score, 0);
  }, [user]); // userå¯¹è±¡çš„ä»»ä½•å˜åŒ–éƒ½ä¼šé‡æ–°è®¡ç®—

  // âœ… ç²¾ç¡®ä¾èµ–
  const expensiveCalc = useMemo(() =&gt; {
    return user.scores.reduce((sum, score) =&gt; sum + score, 0);
  }, [user.scores]); // åªæœ‰scoreså˜åŒ–æ‰é‡æ–°è®¡ç®—
}
</code></pre>
<h3>2. è¿‡åº¦ä¼˜åŒ–</h3>
<pre><code class="language-jsx">// âŒ ä¸å¿…è¦çš„useMemo
function SimpleComponent({ name }) {
  const greeting = useMemo(() =&gt; `Hello, ${name}!`, [name]);
  return &lt;div&gt;{greeting}&lt;/div&gt;;
}

// âœ… ç®€å•è®¡ç®—ä¸éœ€è¦useMemo
function SimpleComponent({ name }) {
  const greeting = `Hello, ${name}!`;
  return &lt;div&gt;{greeting}&lt;/div&gt;;
}

// âŒ ä¸å¿…è¦çš„useCallbackï¼ˆæ²¡æœ‰ä¼ é€’ç»™å­ç»„ä»¶ï¼‰
function Component() {
  const [count, setCount] = useState(0);
  
  const handleClick = useCallback(() =&gt; {
    setCount(count + 1);
  }, [count]);

  return &lt;button onClick={handleClick}&gt;Count: {count}&lt;/button&gt;;
}

// âœ… ç®€å•äº‹ä»¶å¤„ç†ä¸éœ€è¦useCallback
function Component() {
  const [count, setCount] = useState(0);
  
  return (
    &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
      Count: {count}
    &lt;/button&gt;
  );
}
</code></pre>
<h3>3. æ­£ç¡®ä½¿ç”¨React.memo</h3>
<pre><code class="language-jsx">// âœ… é…åˆuseCallbackå’ŒuseMemoä½¿ç”¨React.memo
const ExpensiveChild = React.memo(({ data, onAction }) =&gt; {
  console.log(&#39;ExpensiveChild æ¸²æŸ“&#39;);
  
  return (
    &lt;div&gt;
      {data.map(item =&gt; (
        &lt;div key={item.id} onClick={() =&gt; onAction(item.id)}&gt;
          {item.name}
        &lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
});

function Parent() {
  const [count, setCount] = useState(0);
  const [items, setItems] = useState([
    { id: 1, name: &#39;Item 1&#39; },
    { id: 2, name: &#39;Item 2&#39; }
  ]);

  // ç¼“å­˜æ•°æ®
  const processedItems = useMemo(() =&gt; 
    items.map(item =&gt; ({
      ...item,
      displayName: item.name.toUpperCase()
    })),
    [items]
  );

  // ç¼“å­˜å›è°ƒå‡½æ•°
  const handleAction = useCallback((id) =&gt; {
    console.log(&#39;Action on item:&#39;, id);
  }, []);

  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Count: {count}
      &lt;/button&gt;
      
      {/* ç”±äºä½¿ç”¨äº†ç¼“å­˜ï¼Œè¿™ä¸ªç»„ä»¶ä¸ä¼šå› ä¸ºcountå˜åŒ–è€Œé‡æ–°æ¸²æŸ“ */}
      &lt;ExpensiveChild data={processedItems} onAction={handleAction} /&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>æ€§èƒ½æµ‹è¯•</h2>
<pre><code class="language-jsx">function PerformanceTest() {
  const [data, setData] = useState([]);
  const [filter, setFilter] = useState(&#39;&#39;);
  const [renderCount, setRenderCount] = useState(0);

  // ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®
  useEffect(() =&gt; {
    const testData = Array.from({ length: 10000 }, (_, i) =&gt; ({
      id: i,
      name: `Item ${i}`,
      value: Math.random() * 100,
      category: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;][i % 3]
    }));
    setData(testData);
  }, []);

  // è·Ÿè¸ªæ¸²æŸ“æ¬¡æ•°
  useEffect(() =&gt; {
    setRenderCount(prev =&gt; prev + 1);
  });

  // ç¼“å­˜è¿‡æ»¤åçš„æ•°æ®
  const filteredData = useMemo(() =&gt; {
    console.time(&#39;è¿‡æ»¤æ•°æ®&#39;);
    const result = data.filter(item =&gt; 
      item.name.toLowerCase().includes(filter.toLowerCase())
    );
    console.timeEnd(&#39;è¿‡æ»¤æ•°æ®&#39;);
    return result;
  }, [data, filter]);

  // ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
  const stats = useMemo(() =&gt; {
    console.time(&#39;è®¡ç®—ç»Ÿè®¡&#39;);
    const result = {
      total: filteredData.length,
      averageValue: filteredData.reduce((sum, item) =&gt; sum + item.value, 0) / filteredData.length || 0,
      categories: filteredData.reduce((acc, item) =&gt; {
        acc[item.category] = (acc[item.category] || 0) + 1;
        return acc;
      }, {})
    };
    console.timeEnd(&#39;è®¡ç®—ç»Ÿè®¡&#39;);
    return result;
  }, [filteredData]);

  return (
    &lt;div&gt;
      &lt;div className=&quot;performance-info&quot;&gt;
        &lt;p&gt;æ¸²æŸ“æ¬¡æ•°: {renderCount}&lt;/p&gt;
        &lt;p&gt;æ€»æ•°æ®é‡: {data.length}&lt;/p&gt;
        &lt;p&gt;è¿‡æ»¤åæ•°é‡: {filteredData.length}&lt;/p&gt;
      &lt;/div&gt;
      
      &lt;input
        type=&quot;text&quot;
        placeholder=&quot;æœç´¢...&quot;
        value={filter}
        onChange={(e) =&gt; setFilter(e.target.value)}
      /&gt;
      
      &lt;div className=&quot;stats&quot;&gt;
        &lt;p&gt;å¹³å‡å€¼: {stats.averageValue.toFixed(2)}&lt;/p&gt;
        &lt;p&gt;åˆ†ç±»ç»Ÿè®¡: {JSON.stringify(stats.categories)}&lt;/p&gt;
      &lt;/div&gt;
      
      &lt;div className=&quot;data-list&quot;&gt;
        {filteredData.slice(0, 100).map(item =&gt; (
          &lt;div key={item.id}&gt;
            {item.name} - {item.value.toFixed(2)}
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2>æ€»ç»“</h2>
<p><code>useMemo</code> å’Œ <code>useCallback</code> æ˜¯å¼ºå¤§çš„æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼š</p>
<ol>
<li><p><strong>useMemo</strong>: ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤çš„æ˜‚è´µè®¡ç®—</p>
</li>
<li><p><strong>useCallback</strong>: ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</p>
</li>
<li><p><strong>æœ€ä½³å®è·µ</strong>: </p>
<ul>
<li>åªåœ¨çœŸæ­£éœ€è¦æ—¶ä½¿ç”¨</li>
<li>æ­£ç¡®è®¾ç½®ä¾èµ–é¡¹æ•°ç»„</li>
<li>é…åˆReact.memoä½¿ç”¨</li>
<li>æµ‹é‡æ€§èƒ½æ”¹è¿›æ•ˆæœ</li>
</ul>
</li>
<li><p><strong>æ³¨æ„äº‹é¡¹</strong>:</p>
<ul>
<li>è¿‡åº¦ä¼˜åŒ–å¯èƒ½é€‚å¾—å…¶å</li>
<li>ä¾èµ–é¡¹è¦å‡†ç¡®å®Œæ•´</li>
<li>ç¼“å­˜æœ¬èº«ä¹Ÿæœ‰æˆæœ¬</li>
</ul>
</li>
</ol>
<p>åˆç†ä½¿ç”¨è¿™äº›Hookså¯ä»¥æ˜¾è‘—æå‡Reactåº”ç”¨çš„æ€§èƒ½ã€‚ </p>

          </div>

          <!-- æ–‡æ¡£å¯¼èˆª -->
          <div class="doc-navigation">
            
              <a href="13-useReducer.html" class="nav-btn prev-btn">
                <span class="nav-icon">â†</span>
                <div class="nav-text">
                  <span class="nav-label">ä¸Šä¸€ç¯‡</span>
                  <span class="nav-title">useReducer</span>
                </div>
              </a>
            
            
            
              <a href="15-useRef.html" class="nav-btn next-btn">
                <div class="nav-text">
                  <span class="nav-label">ä¸‹ä¸€ç¯‡</span>
                  <span class="nav-title">useRef</span>
                </div>
                <span class="nav-icon">â†’</span>
              </a>
            
          </div>
        </article>
      </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <span>â†‘</span>
    </button>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 React ä¸­æ–‡æ–‡æ¡£. åŸºäº React 18.x æ„å»º</p>
        <p>Made with â¤ï¸ by Reactä¸­æ–‡ç¤¾åŒº</p>
      </div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>